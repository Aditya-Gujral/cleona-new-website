{"version":3,"file":"VisualEditing.js","sources":["../../src/visual-editing/VisualEditing.tsx"],"sourcesContent":["'use client'\n\nimport {\n  enableVisualEditing,\n  type HistoryAdapterNavigate,\n  type VisualEditingOptions,\n} from '@sanity/visual-editing'\nimport {usePathname, useRouter, useSearchParams} from 'next/navigation.js'\nimport {useEffect, useRef, useState} from 'react'\n\n/**\n * @public\n */\nexport interface VisualEditingProps extends Omit<VisualEditingOptions, 'history'> {\n  /**\n   * @deprecated The histoy adapter is already implemented\n   */\n  history?: never\n}\n\nexport default function VisualEditing(props: VisualEditingProps): null {\n  const {zIndex} = props\n\n  const router = useRouter()\n  const routerRef = useRef(router)\n  const [navigate, setNavigate] = useState<HistoryAdapterNavigate | undefined>()\n\n  useEffect(() => {\n    routerRef.current = router\n  }, [router])\n  useEffect(() => {\n    const disable = enableVisualEditing({\n      zIndex,\n      history: {\n        subscribe: (_navigate) => {\n          setNavigate(() => _navigate)\n          return () => setNavigate(undefined)\n        },\n        update: (update) => {\n          switch (update.type) {\n            case 'push':\n              return routerRef.current.push(update.url)\n            case 'pop':\n              return routerRef.current.back()\n            case 'replace':\n              return routerRef.current.replace(update.url)\n            default:\n              throw new Error(`Unknown update type: ${update.type}`)\n          }\n        },\n      },\n    })\n    return () => disable()\n  }, [zIndex])\n\n  const pathname = usePathname()\n  const searchParams = useSearchParams()\n  useEffect(() => {\n    if (navigate) {\n      navigate({\n        type: 'push',\n        url: `${pathname}${searchParams?.size ? `?${searchParams}` : ''}`,\n      })\n    }\n  }, [navigate, pathname, searchParams])\n\n  return null\n}\n"],"names":["VisualEditing","props","zIndex","router","useRouter","routerRef","useRef","navigate","setNavigate","useState","useEffect","current","disable","enableVisualEditing","history","subscribe","_navigate","update","type","push","url","back","replace","Error","concat","pathname","usePathname","searchParams","useSearchParams","size"],"mappings":"2NAoBA,SAAwBA,EAAcC,GAC9B,MAAAC,OAACA,GAAUD,EAEXE,EAASC,IACTC,EAAYC,EAAOH,IAClBI,EAAUC,GAAeC,IAEhCC,GAAU,KACRL,EAAUM,QAAUR,CAAA,GACnB,CAACA,IACJO,GAAU,KACR,MAAME,EAAUC,EAAoB,CAClCX,SACAY,QAAS,CACPC,UAAYC,IACVR,GAAY,IAAMQ,IACX,IAAMR,OAAY,IAE3BS,OAASA,IACP,OAAQA,EAAOC,MACb,IAAK,OACH,OAAOb,EAAUM,QAAQQ,KAAKF,EAAOG,KACvC,IAAK,MACI,OAAAf,EAAUM,QAAQU,OAC3B,IAAK,UACH,OAAOhB,EAAUM,QAAQW,QAAQL,EAAOG,KAC1C,QACE,MAAM,IAAIG,MAAM,wBAAwBC,OAAAP,EAAOC,OACnD,KAIN,MAAO,IAAMN,GAAQ,GACpB,CAACV,IAEJ,MAAMuB,EAAWC,IACXC,EAAeC,IAUd,OATPlB,GAAU,KACJH,GACOA,EAAA,CACPW,KAAM,OACNE,IAAK,GAAGI,OAAAC,GAAWD,QAAc,MAAAG,OAAA,EAAAA,EAAAE,MAAO,IAAIL,OAAiBG,GAAA,KAEjE,GACC,CAACpB,EAAUkB,EAAUE,IAEjB,IACT"}