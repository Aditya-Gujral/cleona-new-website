{"version":3,"file":"index.cjs","sources":["../src/components/Icon.tsx","../src/datastores/unsplash.ts","../src/components/Photo.styled.tsx","../src/components/Photo.tsx","../src/components/UnsplashAssetSource.styled.tsx","../src/components/UnsplashAssetSource.tsx","../src/index.ts"],"sourcesContent":["export default function UnsplashIcon() {\n  return (\n    <svg role=\"img\" viewBox=\"0 0 25 25\" width=\"1em\" height=\"1em\" fill=\"currentColor\">\n      <title />\n      <path d=\"M9 9V4h7v5H9Zm7 3h5v9H4v-9h5v5h7v-5Z\" />\n    </svg>\n  )\n}\n","import { SanityClient } from '@sanity/client'\nimport { BehaviorSubject, concat, defer, Observable } from 'rxjs'\nimport { debounceTime, distinctUntilChanged, map, switchMap, withLatestFrom } from 'rxjs/operators'\n\nimport { UnsplashPhoto } from '../types'\n\ntype SearchSubject = BehaviorSubject<string>\ntype PageSubject = BehaviorSubject<number>\n\nconst fetchSearch = (\n  client: SanityClient,\n  query: string,\n  page: number,\n  perPage: number,\n): Observable<any> =>\n  defer(\n    () =>\n      client.observable.request({\n        url: `/addons/unsplash/search/photos?query=${encodeURIComponent(\n          query,\n        )}&page=${page}&per_page=${perPage}`,\n        withCredentials: true,\n        method: 'GET',\n      }) as any,\n  )\n\nconst fetchList = (\n  client: SanityClient,\n  type: string,\n  page: number,\n  perPage: number,\n): Observable<any> =>\n  defer(\n    () =>\n      client.observable.request({\n        url: `/addons/unsplash/photos?order_by=${type}&page=${page}&per_page=${perPage}`,\n        withCredentials: true,\n        method: 'GET',\n      }) as any,\n  )\n\nexport function fetchDownloadUrl(client: SanityClient, photo: UnsplashPhoto): Promise<string> {\n  const downloadUrl = photo.links.download_location.replace(\n    'https://api.unsplash.com',\n    '/addons/unsplash',\n  )\n  return client\n    .request({\n      url: downloadUrl,\n      withCredentials: true,\n      method: 'GET',\n    })\n    .then((result: { url: string }) => {\n      return result.url\n    })\n}\n\nexport const search = (\n  client: SanityClient,\n  query: SearchSubject,\n  page: PageSubject,\n  resultsPerPage: number,\n): Observable<any> => {\n  return concat(\n    query.pipe(\n      withLatestFrom(page),\n      debounceTime(500),\n      distinctUntilChanged(),\n      switchMap(([q, p]) => {\n        if (q) {\n          return fetchSearch(client, q, p, resultsPerPage).pipe(\n            distinctUntilChanged(),\n            map((result) => result.results),\n          )\n        }\n        return fetchList(client, 'popular', p, resultsPerPage)\n      }),\n    ),\n  )\n}\n","import { Card } from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const Root = styled.div`\n  overflow: hidden;\n  background-origin: content-box;\n  background-repeat: no-repeat;\n  background-clip: border-box;\n  background-size: cover;\n  position: relative;\n  outline: none !important;\n  border: ${({ theme }) => `1px solid ${theme.sanity.color.card.enabled.border}`};\n  box-sizing: content-box;\n  user-drag: none;\n\n  &:hover {\n    opacity: 0.85;\n  }\n\n  &:focus,\n  &:active {\n    border: 1px solid var(--input-border-color-focus);\n    box-shadow: inset 0 0 0 3px var(--input-border-color-focus);\n  }\n`\n\nexport const CreditLineLink = styled.a`\n  text-decoration: none;\n  cursor: pointer;\n`\n\nexport const CreditLine = styled(Card)`\n  ${({ theme }) => `\n     --creditline-fg: ${theme.sanity.color.card.enabled.fg};\n     --creditline-bg: ${theme.sanity.color.card.enabled.bg};\n   `};\n  user-drag: none;\n  position: absolute;\n  background-color: var(--creditline-bg);\n  bottom: 0;\n\n  [data-ui='Text'] {\n    color: var(--creditline-fg);\n  }\n`\n","import { Text } from '@sanity/ui'\nimport { useCallback, useEffect } from 'react'\n\nimport { UnsplashPhoto } from '../types'\nimport { CreditLine, CreditLineLink, Root } from './Photo.styled'\n\ntype Props = {\n  data: UnsplashPhoto\n  width: number\n  height: number\n  onClick: (photo: UnsplashPhoto) => void\n  onKeyDown: (event: any) => void\n  active: boolean\n  onFocus: (photo: UnsplashPhoto) => void\n}\n\nconst UTM_SOURCE = 'sanity-plugin-asset-source-unsplash'\n\nexport default function Photo(props: Props) {\n  const { onClick, data, onKeyDown, onFocus, active, width, height } = props\n\n  const handleClick = useCallback(() => {\n    onClick(data)\n  }, [onClick, data])\n\n  const handleCreditLineClicked = useCallback(\n    (event: any) => {\n      event.stopPropagation()\n      const url = `${data.links.html}?utm_source=${encodeURIComponent(\n        UTM_SOURCE,\n      )}&utm_medium=referral`\n      window.open(url, data.id, 'noreferrer,noopener')\n    },\n    [data],\n  )\n\n  const handleKeyDown = useCallback(\n    (event: any) => {\n      onKeyDown(event)\n      if (event.keyCode === 13) {\n        onClick(data)\n      }\n    },\n    [onKeyDown, data, onClick],\n  )\n\n  const handleMouseDown = useCallback(() => {\n    onFocus(data)\n  }, [onFocus, data])\n\n  useEffect(() => {\n    if (active) {\n      onFocus(data)\n    }\n  }, [active, data, onFocus])\n\n  const src = data.urls.small\n  const userName = data.user.name\n\n  return (\n    <Root\n      title={`Select image by ${userName} from Unsplash`}\n      tabIndex={0}\n      onKeyDown={handleKeyDown}\n      onMouseDown={handleMouseDown}\n      style={{\n        width: `${width}px`,\n        height: `${height}px`,\n        backgroundImage: `url(\"${src}\")`,\n      }}\n      onClick={handleClick}\n    >\n      <CreditLineLink onClick={handleCreditLineClicked}>\n        <CreditLine padding={2} radius={2} margin={2}>\n          <Text size={1} title={`Open image by ${userName} on Unsplash in new window`}>\n            By @{data.user.username}\n          </Text>\n        </CreditLine>\n      </CreditLineLink>\n    </Root>\n  )\n}\n","import { Stack } from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const Search = styled(Stack)`\n  position: sticky;\n  top: 0;\n  z-index: 1;\n`\n\nexport const Scroller = styled.div`\n  overflow-y: auto;\n  max-height: 80vh;\n`\n","import { SanityClient } from '@sanity/client'\nimport { Card, Dialog, Flex, Spinner, Stack, Text, TextInput } from '@sanity/ui'\nimport React from 'react'\nimport InfiniteScroll from 'react-infinite-scroll-component'\nimport PhotoAlbum from 'react-photo-album'\nimport { BehaviorSubject, Subscription } from 'rxjs'\nimport { AssetFromSource, AssetSourceComponentProps, useClient } from 'sanity'\n\nimport { fetchDownloadUrl, search } from '../datastores/unsplash'\nimport { UnsplashPhoto } from '../types'\nimport Photo from './Photo'\nimport { Search } from './UnsplashAssetSource.styled'\n\ntype State = {\n  query: string\n  searchResults: UnsplashPhoto[][]\n  page: number\n  isLoading: boolean\n  cursor: number\n}\n\nconst RESULTS_PER_PAGE = 42\nconst PHOTO_SPACING = 2\nconst PHOTO_PADDING = 1 // offset the 1px border width\n\nexport default function UnsplashAssetSource(props: AssetSourceComponentProps) {\n  const client = useClient({ apiVersion: '2022-09-01' })\n  return <UnsplashAssetSourceInternal {...props} client={client} />\n}\n\nclass UnsplashAssetSourceInternal extends React.Component<\n  AssetSourceComponentProps & { client: SanityClient },\n  State\n> {\n  static defaultProps = {\n    selectedAssets: undefined,\n  }\n\n  state = {\n    cursor: 0,\n    query: '',\n    page: 1,\n    searchResults: [[]],\n    isLoading: true,\n  }\n\n  searchSubscription: Subscription | null = null\n\n  searchSubject$ = new BehaviorSubject('')\n  pageSubject$ = new BehaviorSubject(1)\n\n  componentDidMount() {\n    this.searchSubscription = search(\n      this.props.client,\n      this.searchSubject$,\n      this.pageSubject$,\n      RESULTS_PER_PAGE,\n    ).subscribe({\n      next: (results: UnsplashPhoto[]) => {\n        this.setState((prev) => ({\n          searchResults: [...prev.searchResults, results],\n          isLoading: false,\n        }))\n      },\n    })\n  }\n\n  componentWillUnmount() {\n    if (this.searchSubscription) {\n      this.searchSubscription.unsubscribe()\n    }\n  }\n\n  handleSelect = (photo: UnsplashPhoto) => {\n    this.setState({ isLoading: true })\n    return fetchDownloadUrl(this.props.client, photo).then((downloadUrl) => {\n      const description = photo.description || undefined\n      const asset: AssetFromSource = {\n        kind: 'url',\n        value: downloadUrl,\n        assetDocumentProps: {\n          _type: 'sanity.imageAsset',\n          source: {\n            name: 'unsplash',\n            id: photo.id,\n            url: photo.links.html,\n          },\n          description,\n          creditLine: `${photo.user.name} by Unsplash`,\n        } as any,\n      }\n      this.props.onSelect([asset])\n    })\n  }\n\n  handleClose = () => {\n    this.props.onClose()\n  }\n\n  handleSearchTermChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const query = event.currentTarget.value\n    this.setState({ query, page: 1, searchResults: [[]], isLoading: true, cursor: 0 })\n    this.pageSubject$.next(1)\n    this.searchSubject$.next(query)\n  }\n\n  handleScollerLoadMore = () => {\n    // eslint-disable-next-line react/no-access-state-in-setstate\n    const nextPage = this.state.page + 1\n    this.setState({ page: nextPage, isLoading: true })\n    this.pageSubject$.next(nextPage)\n    this.searchSubject$.next(this.state.query)\n  }\n\n  handleKeyDown = (event: any) => {\n    const { cursor } = this.state\n    if ((event.keyCode === 38 || event.keyCode === 37) && cursor > 0) {\n      this.setState((prevState) => ({\n        cursor: prevState.cursor - 1,\n      }))\n    } else if (\n      (event.keyCode === 40 || event.keyCode === 39) &&\n      cursor < this.getPhotos().length - 1\n    ) {\n      this.setState((prevState) => ({\n        cursor: prevState.cursor + 1,\n      }))\n    }\n  }\n\n  getPhotos() {\n    return this.state.searchResults.flat()\n  }\n\n  updateCursor = (photo: UnsplashPhoto) => {\n    const index = this.getPhotos().findIndex((result: UnsplashPhoto) => result.id === photo.id)\n    this.setState({ cursor: index })\n  }\n\n  renderImage = (props: any) => {\n    const { photo, layout } = props\n    const active =\n      this.getPhotos().findIndex((result: UnsplashPhoto) => result.id === photo.data.id) ===\n        this.state.cursor || false\n    return (\n      <Photo\n        onClick={this.handleSelect.bind(photo.data)}\n        onKeyDown={this.handleKeyDown}\n        data={photo.data}\n        width={layout.width}\n        height={layout.height}\n        active={active}\n        onFocus={this.updateCursor}\n      />\n    )\n  }\n\n  render() {\n    const { query, searchResults, isLoading } = this.state\n\n    return (\n      <Dialog\n        id=\"unsplash-asset-source\"\n        header=\"Select image from Unsplash\"\n        onClose={this.handleClose}\n        open\n        width={4}\n      >\n        <Stack space={3} padding={4}>\n          <Card>\n            <Search space={3}>\n              <Text size={1} weight=\"semibold\">\n                Search Unsplash\n              </Text>\n              <TextInput\n                label=\"Search Unsplash.com\"\n                placeholder=\"Topics or colors\"\n                value={query}\n                onChange={this.handleSearchTermChanged}\n              />\n            </Search>\n          </Card>\n          {!isLoading && this.getPhotos().length === 0 && (\n            <Text size={1} muted>\n              No results found\n            </Text>\n          )}\n          <InfiniteScroll\n            dataLength={this.getPhotos().length} // This is important field to render the next data\n            next={this.handleScollerLoadMore}\n            // scrollableTarget=\"unsplash-scroller\"\n            hasMore\n            scrollThreshold={0.99}\n            height=\"60vh\"\n            loader={\n              <Flex align=\"center\" justify=\"center\" padding={3}>\n                <Spinner muted />\n              </Flex>\n            }\n            endMessage={\n              <Text size={1} muted>\n                No more results\n              </Text>\n            }\n          >\n            {searchResults\n              .filter((photos) => photos.length > 0)\n              .map((photos: UnsplashPhoto[], index) => (\n                <PhotoAlbum\n                  // eslint-disable-next-line react/no-array-index-key\n                  key={`gallery-${query || 'popular'}-${index}`}\n                  layout=\"rows\"\n                  spacing={PHOTO_SPACING}\n                  padding={PHOTO_PADDING}\n                  targetRowHeight={(width) => {\n                    if (width < 300) return 150\n                    else if (width < 600) return 200\n                    return 300\n                  }}\n                  photos={photos.map((photo: UnsplashPhoto) => ({\n                    src: photo.urls.small,\n                    width: photo.width,\n                    height: photo.height,\n                    key: photo.id,\n                    data: photo,\n                  }))}\n                  renderPhoto={this.renderImage}\n                  componentsProps={{\n                    containerProps: { style: { marginBottom: `${PHOTO_SPACING}px` } },\n                  }}\n                />\n              ))}\n          </InfiniteScroll>\n        </Stack>\n      </Dialog>\n    )\n  }\n}\n","import { AssetSource, definePlugin } from 'sanity'\n\nimport Icon from './components/Icon'\nimport Unsplash from './components/UnsplashAssetSource'\n\nexport type { Asset, AssetDocument, UnsplashPhoto } from './types'\n\n/**\n * @public\n */\nexport const unsplashAssetSource: AssetSource = {\n  name: 'unsplash',\n  title: 'Unsplash',\n  component: Unsplash,\n  icon: Icon,\n}\n\n/**\n * @public\n */\nexport const unsplashImageAsset = definePlugin({\n  name: 'asset-source-unsplash-plugin',\n\n  form: {\n    image: {\n      assetSources: (prev) => {\n        return [...prev, unsplashAssetSource]\n      },\n    },\n  },\n})\n"],"names":["UnsplashIcon","jsxs","role","viewBox","width","height","fill","children","jsx","d","fetchSearch","client","query","page","perPage","defer","observable","request","url","concat","encodeURIComponent","withCredentials","method","fetchList","type","fetchDownloadUrl","photo","downloadUrl","links","download_location","replace","then","result","search","resultsPerPage","pipe","withLatestFrom","debounceTime","distinctUntilChanged","switchMap","_ref","q","p","map","results","_a","_b","_c","Root","styled","div","__template","_ref2","theme","sanity","color","card","enabled","border","CreditLineLink","a","CreditLine","default","Card","_ref3","fg","bg","UTM_SOURCE","Photo","props","onClick","data","onKeyDown","onFocus","active","handleClick","useCallback","handleCreditLineClicked","event","stopPropagation","html","window","open","id","handleKeyDown","keyCode","handleMouseDown","useEffect","src","urls","small","userName","user","name","title","tabIndex","onMouseDown","style","backgroundImage","padding","radius","margin","Text","size","username","Search","Stack","RESULTS_PER_PAGE","PHOTO_SPACING","PHOTO_PADDING","UnsplashAssetSource","useClient","apiVersion","UnsplashAssetSourceInternal","React","Component","constructor","arguments","__publicField","cursor","searchResults","isLoading","BehaviorSubject","setState","description","asset","kind","value","assetDocumentProps","_type","source","creditLine","onSelect","onClose","currentTarget","pageSubject$","next","searchSubject$","nextPage","state","prevState","getPhotos","length","index","findIndex","layout","handleSelect","bind","updateCursor","componentDidMount","searchSubscription","subscribe","prev","componentWillUnmount","unsubscribe","flat","render","Dialog","header","handleClose","space","weight","TextInput","label","placeholder","onChange","handleSearchTermChanged","muted","InfiniteScroll","dataLength","handleScollerLoadMore","hasMore","scrollThreshold","loader","Flex","align","justify","Spinner","endMessage","filter","photos","PhotoAlbum","spacing","targetRowHeight","key","renderPhoto","renderImage","componentsProps","containerProps","marginBottom","selectedAssets","unsplashAssetSource","component","Unsplash","icon","Icon","unsplashImageAsset","definePlugin","form","image","assetSources"],"mappings":"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"}