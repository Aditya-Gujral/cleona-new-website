<<<<<<< HEAD
// Converts an array of simple values (strings, numbers only) to a jsonmatch path string.

const IS_DOTTABLE = /^[a-z_$]+/

function stringifySegment(segment, hasLeading) {
  const type = typeof segment

  const isNumber = type === 'number'

  if (isNumber) {
    return `[${segment}]`
  }

  const isObject = type === 'object' && segment !== null && segment !== undefined

  if (isObject) {
    return Object.keys(segment)
      .map((key) => {
        const val = segment[key]
        return `[${key}=="${val}"]`
      })
      .join('')
  }

  if (IS_DOTTABLE.test(segment)) {
=======
import {type Path, type PathSegment} from '@sanity/types'

import {isRecord} from '../util'

const IS_DOTTABLE = /^[a-z_$]+/

/**
 * Converts a path in array form to a JSONPath string
 *
 * @param pathArray - Array of path segments
 * @returns String representation of the path
 * @internal
 */
export function arrayToJSONMatchPath(pathArray: Path): string {
  let path = ''
  pathArray.forEach((segment, index) => {
    path += stringifySegment(segment, index === 0)
  })
  return path
}

// Converts an array of simple values (strings, numbers only) to a jsonmatch path string.
function stringifySegment(
  segment: PathSegment | Record<string, unknown>,
  hasLeading: boolean,
): string {
  if (typeof segment === 'number') {
    return `[${segment}]`
  }

  if (isRecord(segment)) {
    const seg = segment as Record<string, unknown>
    return Object.keys(segment)
      .map((key) => (isPrimitiveValue(seg[key]) ? `[${key}=="${seg[key]}"]` : ''))
      .join('')
  }

  if (typeof segment === 'string' && IS_DOTTABLE.test(segment)) {
>>>>>>> origin/main
    return hasLeading ? segment : `.${segment}`
  }

  return `['${segment}']`
}

<<<<<<< HEAD
export default function arrayToJSONMatchPath(pathArray: Array<string | number | object>): string {
  return pathArray.reduce((acc, segment, index) => {
    return acc + stringifySegment(segment, index === 0)
  }, '')
=======
function isPrimitiveValue(val: unknown): val is string | number | boolean {
  switch (typeof val) {
    case 'number':
    case 'string':
    case 'boolean':
      return true
    default:
      return false
  }
>>>>>>> origin/main
}
