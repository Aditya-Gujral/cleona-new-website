"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5266],{58855:function(e,t,n){n.d(t,{L9:function(){return t$},YH:function(){return tN},_F:function(){return el},iV:function(){return tJ},q$:function(){return tO}});var i=n(57437),r=n(12916),l=n(47710),o=n(2265),s=n(68540),a=n(69664),c=n(55022),h=n(17245),u=n(89183),d=n(95492),p=n(69944),f=n(85727),g=n(71648),y=n(97019),m=n(15536),k=n(39133),b=n(10462),v=n(42764),x=n(86927),_=n(32999),N=n(48527),w=n(13232),E=n(22170);let M="sanity-pte:";function T(e){let t=`${M}${e}`;return c&&c.enabled(t)?c(t):c(M)}function C(e,t,n){let i;let r=[e.path[0]];if(!t)return null;let l=t[r[0]];if(!l)return null;let o=[{_key:l._key}];if(l._type!==n.block.name)return o;let s=e.path.slice(0,2),a=Array.isArray(l.children)&&l.children[s[1]];return a&&(i=["children",{_key:a._key}]),i?[...o,...i]:o}function L(e,t){if(!t)return[];let[n,i]=Array.from(s.ML.nodes(t,{at:[],match:t=>(0,h.Fd)(e.path[0])&&t._key===e.path[0]._key}))[0]||[void 0,void 0];if(!n||!s.W_.isElement(n))return[];if(t.isVoid(n))return[i[0],0];let l=[e.path[2]],o=n.children.findIndex(e=>r([{_key:e._key}],l));if(o>=0&&n.children[o]){let e=n.children[o];return s.W_.isElement(e)&&t.isVoid(e)?i.concat(o).concat(0):i.concat(o)}return i}function S(e,t,n){if(!t)return null;let i=null,r=null,l=t.anchor&&C(t.anchor,e,n);l&&t.anchor&&(i={path:l,offset:t.anchor.offset});let o=t.focus&&C(t.focus,e,n);o&&t.focus&&(r={path:o,offset:t.focus.offset});let a=!!(s.e6.isRange(t)&&s.e6.isBackward(t));return i&&r?{anchor:i,focus:r,backward:a}:null}function R(e,t){if(!e||!t)return null;let n={path:L(e.anchor,t),offset:e.anchor.offset},i={path:L(e.focus,t),offset:e.focus.offset};return 0===i.path.length||0===n.path.length?null:n&&i?{anchor:n,focus:i}:null}function A(e,t){if(!e||!t)return null;let n=[],i=e.offset||0,r="object"==typeof e.path[0]&&"_key"in e.path[0]&&e.path[0]._key,l="object"==typeof e.path[2]&&"_key"in e.path[2]&&e.path[2]._key,o=t.find(e=>e._key===r);if(!o)return null;if(n.push({_key:o._key}),o&&"children"===e.path[1]){if(!o.children||Array.isArray(o.children)&&0===o.children.length)return null;let t=Array.isArray(o.children)&&o.children.find(e=>e._key===l);if(!t)return null;n.push("children"),n.push({_key:t._key}),i=t.text&&t.text.length>=e.offset?e.offset:t.text&&t.text.length||0}return{path:n,offset:i}}c(M);let D=[],$="void-child";function B(e,t){let n=t[e._key];return n&&r(e,n)?n:(t[e._key]=e,e)}function P(e,{schemaTypes:t},n={}){return e&&Array.isArray(e)?e.map(e=>{let{_type:i,_key:r,...l}=e,o=[{_key:$,_type:"span",text:"",marks:[]}];if(e&&e._type===t.block.name){let a=!1,c=typeof e.style>"u",h=typeof e.markDefs>"u",u=typeof e.children>"u",d=(e.children||[]).map(e=>{let{_type:t,_key:i,...r}=e;return"span"!==t?(a=!0,B({_type:t,_key:i,children:o,value:r,__inline:!0},n)):e});return!(!c&&!h&&!u&&!a&&s.W_.isElement(e))?(c&&(l.style=t.styles[0].value),B({_type:i,_key:r,...l,children:d},n)):e}return B({_type:i,_key:r,children:o,value:l},n)}):[]}function I(e,t,n={}){return e.map(e=>{let{_key:i,_type:r}=e;if(!i||!r)throw Error("Not a valid block");if(r===t&&"children"in e&&Array.isArray(e.children)&&i){let t=!1,l=e.children.map(e=>{let{_type:i}=e;if("value"in e&&"span"!==i){t=!0;let{value:i,_key:r,_type:l,__inline:o,children:s,...a}=e;return B({...a,...i,_key:r,_type:l},n)}return e});return t?B({...e,children:l,_key:i,_type:r},n):e}let l="value"in e&&e.value;return B({_key:i,_type:r,..."object"==typeof l?l:{}},n)})}function j(e,t){return void 0===e||e&&Array.isArray(e)&&0===e.length||e&&Array.isArray(e)&&1===e.length&&s.W_.isElement(e[0])&&e[0]._type===t.block.name&&"style"in e[0]&&e[0].style===t.styles[0].value&&!("listItem"in e[0])&&Array.isArray(e[0].children)&&1===e[0].children.length&&s.xv.isText(e[0].children[0])&&"span"===e[0].children[0]._type&&!e[0].children[0].marks?.join("")&&""===e[0].children[0].text}let O=new WeakMap,Y=new WeakMap,z=new WeakMap,W=new WeakMap,V=new WeakMap,F=new WeakMap,J=new WeakMap,H=new WeakMap,U=new WeakMap,q=e=>(0,i.jsx)("div",{children:(0,i.jsx)("pre",{children:JSON.stringify(e.value,null,2)})}),G=u.zo.div`
  user-select: none;
  border: ${e=>e.selected?"1px solid blue":"1px solid transparent"};
`;u.zo.span`
  background: #999;
  border: ${e=>e.selected?"1px solid blue":"1px solid transparent"};
`;let K=u.zo.div`
  &.pt-list-item {
    width: fit-content;
    position: relative;
    display: block;

    /* Important 'transform' in order to force refresh the ::before and ::after rules
      in Webkit: https://stackoverflow.com/a/21947628/831480
    */
    transform: translateZ(0);
    margin-left: ${e=>(function(e){switch(Number(e)){case 1:return"1.5em";case 2:return"3em";case 3:return"4.5em";case 4:return"6em";case 5:return"7.5em";case 6:return"9em";case 7:return"10.5em";case 8:return"12em";case 9:return"13.5em";case 10:return"15em";default:return"0em"}})(e.listLevel)};
  }
  &.pt-list-item > .pt-list-item-inner {
    display: flex;
    margin: 0;
    padding: 0;
    &:before {
      justify-content: flex-start;
      vertical-align: top;
    }
  }
  &.pt-list-item-bullet > .pt-list-item-inner:before {
      content: '${e=>{var t;return t=e.listLevel,"bullet"===e.listStyle?Z[(t-1)%3]:"*"}}';
      font-size: 0.4375rem; /* 7px */
      line-height: 1.5rem; /* Same as body text */
      /* Optical alignment */
      position: relative;
    }
  }
  &.pt-list-item-bullet > .pt-list-item-inner {
    &:before {
      min-width: 1.5rem; /* Make sure space between bullet and text never shrinks */
    }
  }
  &.pt-list-item-number {
    counter-increment: ${e=>(function(e){switch(e){case 1:return"listItemNumber";case 2:return"listItemAlpha";case 3:return"listItemRoman";case 4:return"listItemNumberNext";case 5:return"listItemLetterNext";case 6:return"listItemRomanNext";case 7:return"listItemNumberNextNext";case 8:return"listItemAlphaNextNext";case 9:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel)};
    counter-reset: ${e=>(function(e){switch(e){case 1:return"listItemAlpha";case 2:return"listItemRoman";case 3:return"listItemNumberNext";case 4:return"listItemLetterNext";case 5:return"listItemRomanNext";case 6:return"listItemNumberNextNext";case 7:return"listItemAlphaNextNext";case 8:return"listItemRomanNextNext";default:return"listItemNumberNextNextNext"}})(e.listLevel)};
  }
  & + :not(.pt-list-item-number) {
    counter-reset: listItemNumber;
  }
  &.pt-list-item-number > .pt-list-item-inner:before {
    content: ${e=>(function(e){switch(e){case 1:return"counter(listItemNumber) '. '";case 2:return"counter(listItemAlpha, lower-alpha) '. '";case 3:return"counter(listItemRoman, lower-roman) '. '";case 4:return"counter(listItemNumberNext) '. '";case 5:return"counter(listItemLetterNext, lower-alpha) '. '";case 6:return"counter(listItemRomanNext, lower-roman) '. '";case 7:return"counter(listItemNumberNextNext) '. '";case 8:return"counter(listItemAlphaNextNext, lower-alpha) '. '";case 9:return"counter(listItemRomanNextNext, lower-roman) '. '";default:return"counter(listItemNumberNextNextNext) '. '"}})(e.listLevel)};
    min-width: 1.5rem; /* Make sure space between number and text never shrinks */
    /* Optical alignment */
    position: relative;
    top: 1px;
  }
`,X=u.zo.div``,Z=["●","○","■"],Q=T("components:DraggableBlock"),ee=({children:e,element:t,readOnly:n,blockRef:r})=>{let l=(0,a._7)(),c=(0,o.useRef)(),[h,u]=(0,o.useState)(!1),d=(0,o.useMemo)(()=>s.ML.isVoid(l,t),[l,t]),p=(0,o.useMemo)(()=>s.ML.isInline(l,t),[l,t]),[f,g]=(0,o.useState)(null);(0,o.useEffect)(()=>g(r?r.current:a.F3.toDOMNode(l,t)),[l,t,r]);let y=(0,o.useCallback)(e=>{let n=W.get(l);if(!n||!f)return;e.preventDefault(),e.dataTransfer.dropEffect="move",V.set(l,t);let i=f.getBoundingClientRect(),r=i.top,o=i.height,s=e.pageY,a="bottom";if(t===l.children[0]?a="top":(a=Math.abs(r-s)<o/2?"top":"bottom",F.set(l,a)),n===t){e.dataTransfer.dropEffect="none";return}u(!0)},[f,l,t]),m=(0,o.useCallback)(()=>{u(!1)},[]),k=(0,o.useCallback)(e=>{let n=V.get(l);if(n){z.set(l,!1),e.preventDefault(),e.stopPropagation(),V.delete(l),c.current&&(Q("Removing drag ghost"),document.body.removeChild(c.current));let i=F.get(l);F.delete(l);let r=a.F3.findPath(l,n),o=a.F3.findPath(l,t),h=s.y$.isBefore(o,r);if("bottom"===i&&!h){if(r[0]>=l.children.length-1){Q("target is already at the bottom, not moving");return}let e=r;r=s.y$.next(r),Q(`Adjusting targetPath from ${JSON.stringify(e)} to ${JSON.stringify(r)}`)}if("top"===i&&h&&r[0]!==l.children.length-1){let e=r;r=s.y$.previous(r),Q(`Adjusting targetPath from ${JSON.stringify(e)} to ${JSON.stringify(r)}`)}if(s.y$.equals(r,o)){e.preventDefault(),Q("targetPath and myPath is the same, not moving");return}Q(`Moving element ${t._key} from path ${JSON.stringify(o)} to ${JSON.stringify(r)} (${i})`),s.YR.moveNodes(l,{at:o,to:r}),l.onChange();return}Q("No target element, not doing anything")},[l,t]),b=(0,o.useCallback)(e=>{W.get(l)&&(Q("On drop (prevented)",t),e.preventDefault(),e.stopPropagation(),u(!1))},[l,t]),v=(0,o.useCallback)(e=>{if(!d){W.delete(l);return}z.set(l,!0),W.set(l,t),e.stopPropagation();let n=e.target;n instanceof HTMLElement&&(n.style.opacity="1")},[l,t,d]),x=(0,o.useCallback)(e=>{if(!d||p){Q("Not dragging block"),W.delete(l),z.set(l,!1);return}if(Q("Drag start"),z.set(l,!0),e.dataTransfer&&(e.dataTransfer.setData("application/portable-text","something"),e.dataTransfer.effectAllowed="move"),f&&f instanceof HTMLElement){let t=f.cloneNode(!0),n=t.querySelector("[data-pt-drag-ghost-element]");if(n&&(t=n),t.setAttribute("data-dragged",""),document.body){c.current=t,t.style.position="absolute",t.style.left="-99999px",t.style.boxSizing="border-box",document.body.appendChild(t);let n=f.getBoundingClientRect(),i=e.clientX-n.left,r=e.clientY-n.top;t.style.width=`${n.width}px`,t.style.height=`${n.height}px`,e.dataTransfer.setDragImage(t,i,r)}}v(e)},[f,l,v,p,d]),_=h&&l.children[0]===V.get(l),N=h&&l.children[l.children.length-1]===V.get(l),w=F.get(l),E=_||h&&!_&&!N&&"top"===w,M=N||h&&!_&&!N&&"bottom"===w,T=(0,o.useMemo)(()=>(0,i.jsx)("div",{className:"pt-drop-indicator",style:{position:"absolute",width:"100%",height:1,borderBottom:"1px solid currentColor",zIndex:5}}),[]);return n?(0,i.jsx)(i.Fragment,{children:e}):(0,i.jsxs)("div",{draggable:d,onDragStart:x,onDrag:v,onDragOver:y,onDragLeave:m,onDragEnd:k,onDrop:b,children:[E&&T,e,M&&T]})};T("components:Element");let et=[],en={display:"inline-block"},ei=({attributes:e,children:t,element:n,schemaTypes:r,readOnly:l,renderBlock:c,renderChild:h,renderListItem:u,renderStyle:d,spellCheck:p})=>{let f;let g=(0,a._7)(),y=(0,a.vt)(),m=(0,o.useRef)(null),k=(0,o.useRef)(null),b=y&&g.selection&&s.e6.isCollapsed(g.selection)||!1,v=(0,o.useMemo)(()=>I([n],r.block.name,H.get(g))[0],[g,n,r.block.name]),x=t,_,N=(0,o.useMemo)(()=>[{_key:n._key}],[n]);if("string"!=typeof n._type)throw Error("Expected element to have a _type property");if("string"!=typeof n._key)throw Error("Expected element to have a _key property");if(g.isInline(n)){let o=a.F3.findPath(g,n),[c]=s.ML.node(g,o,{depth:1}),u=r.inlineObjects.find(e=>e.name===n._type);if(!u)throw Error("Could not find type for inline block element");if(s.W_.isElement(c)){let r=[{_key:c._key},"children",{_key:n._key}];return(0,i.jsxs)("span",{...e,children:[t,(0,i.jsxs)("span",{draggable:!l,className:"pt-inline-object","data-testid":"pt-inline-object",ref:k,style:en,contentEditable:!1,children:[h&&h({annotations:et,children:(0,i.jsx)(q,{value:v}),editorElementRef:k,focused:b,path:r,schemaType:u,selected:y,type:u,value:v}),!h&&(0,i.jsx)(q,{value:v})]},n._key)]})}throw Error("Block not found!")}if(n._type===r.block.name){let o;_="pt-block pt-text-block";let s="listItem"in n,a="style"in n&&n.style||"normal";_=`pt-block pt-text-block pt-text-block-style-${a}`;let h=r.styles.find(e=>e.value===a);if(d&&h&&(x=d({block:n,children:t,focused:b,selected:y,value:a,path:N,schemaType:h,editorElementRef:m})),s&&("number"==typeof n.level&&(o=n.level),_+=` pt-list-item pt-list-item-${n.listItem} pt-list-item-level-${o||1}`),g.isListBlock(v)&&s&&n.listItem){let e=r.lists.find(e=>e.value===n.listItem);x=u&&e?u({block:v,children:x,focused:b,selected:y,value:n.listItem,path:N,schemaType:e,level:v.level||1,editorElementRef:m}):(0,i.jsx)(K,{listStyle:v.listItem||r.lists[0].value,listLevel:v.level||1,children:(0,i.jsx)(X,{children:x})})}let f=Object.defineProperty({children:x,editorElementRef:m,focused:b,level:o,listItem:s?n.listItem:void 0,path:N,selected:y,style:a,schemaType:r.block,value:v},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),r.block)}),k=c?c(f):t;return(0,i.jsx)("div",{...e,className:_,spellCheck:p,children:(0,i.jsx)(ee,{element:n,readOnly:l,blockRef:m,children:(0,i.jsx)("div",{ref:m,children:k})})},n._key)}let w=r.blockObjects.find(e=>e.name===n._type);if(!w)throw Error(`Could not find schema type for block element of _type ${n._type}`);_="pt-block pt-object-block";let E=I([n],r.block.name,H.get(g))[0];return c&&(f=c(Object.defineProperty({children:(0,i.jsx)(q,{value:v}),editorElementRef:m,focused:b,path:N,schemaType:w,selected:y,value:E},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),w)}))),(0,i.jsxs)("div",{...e,className:_,children:[t,(0,i.jsxs)(ee,{element:n,readOnly:l,blockRef:m,children:[f&&(0,i.jsx)("div",{ref:m,contentEditable:!1,children:f}),!f&&(0,i.jsx)(G,{selected:y,children:(0,i.jsx)(q,{value:v})})]})]},n._key)},er=(0,o.createContext)(null),el=()=>{let e=(0,o.useContext)(er);if(!e)throw Error("The `usePortableTextEditor` hook must be used inside the <PortableTextEditor> component's context.");return e};function eo(e){let t=(0,o.useCallback)(()=>alert(JSON.stringify(e.annotation)),[e.annotation]);return(0,i.jsx)("span",{style:{color:"blue"},onClick:t,children:e.children})}function es(e){if(!e)throw Error("Parameter 'portabletextType' missing (required)");let t=e.of?.find(function e(t){return t.type?e(t.type):"block"===t.name?t:null});if(!t)throw Error("Block type is not defined in this schema (required)");let n=t.fields?.find(e=>"children"===e.name);if(!n)throw Error("Children field for block type found in schema (required)");let i=n.type.of;if(!i)throw Error("Valid types for block children not found in schema (required)");let r=i.find(e=>"span"===e.name);if(!r)throw Error("Span type not found in schema (required)");let l=i.filter(e=>"span"!==e.name)||[],o=e.of?.filter(e=>e.name!==t.name)||[];return{styles:function(e){let t=e.fields?.find(e=>"style"===e.name);if(!t)throw Error("A field with name 'style' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list?.filter(e=>e.value);if(!n||0===n.length)throw Error("The style fields need at least one style defined. I.e: {title: 'Normal', value: 'normal'}.");return n}(t),decorators:r.decorators,lists:function(e){let t=e.fields?.find(e=>"listItem"===e.name);if(!t)throw Error("A field with name 'listItem' is not defined in the block type (required).");let n=t.type.options?.list&&t.type.options.list.filter(e=>e.value);if(!n)throw Error("The list field need at least to be an empty array");return n}(t),block:t,span:r,portableText:e,inlineObjects:l,blockObjects:o,annotations:r.annotations}}function ea(e){return f.V.compile({name:"blockTypeSchema",types:[e]}).get(e.name)}let ec=T("operationToPatches"),eh=T("API:editable");function eu(e,t){let n=ed(e)||!1;O.set(e,!0),t(),O.set(e,n)}function ed(e){return O.get(e)}let ep=new WeakMap,ef=new WeakMap;function eg(e){return ep.get(e)??!1}function ey(e){return ef.get(e)??!1}function em(e){let[t,n]=e;return[t,n]}function ek(e,t){let n=e,i=t,r=n.length,l=i.length;if(0===r||0===l)return 0;r>l?n=n.substring(r-l):r<l&&(i=i.substring(0,r));let o=Math.min(r,l);if(n===i)return o;let s=0,a=1;for(let e=0;-1!==e;){let t=n.substring(o-a);if(-1===(e=i.indexOf(t)))break;a+=e,(0===e||n.substring(o-a)===i.substring(0,a))&&(s=a,a++)}return s}function eb(e,t){if(!e||!t||e[0]!==t[0])return 0;let n=0,i=Math.min(e.length,t.length),r=i,l=0;for(;n<r;)e.substring(l,r)===t.substring(l,r)?l=n=r:i=r,r=Math.floor((i-n)/2+n);return r}function ev(e,t){if(!e||!t||e[e.length-1]!==t[t.length-1])return 0;let n=0,i=Math.min(e.length,t.length),r=i,l=0;for(;n<r;)e.substring(e.length-r,e.length-l)===t.substring(t.length-r,t.length-l)?l=n=r:i=r,r=Math.floor((i-n)/2+n);return r}let ex=/[^a-zA-Z0-9]/,e_=/\s/,eN=/[\r\n]/,ew=/\n\r?\n$/,eE=/^\r?\n\r?\n/;function eM(e){let t=e.map(e=>em(e));function n(e,t){if(!e||!t)return 6;let n=e.charAt(e.length-1),i=t.charAt(0),r=n.match(ex),l=i.match(ex),o=r&&n.match(e_),s=l&&i.match(e_),a=o&&n.match(eN),c=s&&i.match(eN),h=a&&e.match(ew),u=c&&t.match(eE);return h||u?5:a||c?4:r&&!o&&s?3:o||s?2:r||l?1:0}let i=1;for(;i<t.length-1;){if(t[i-1][0]===eA&&t[i+1][0]===eA){let e=t[i-1][1],r=t[i][1],l=t[i+1][1],o=ev(e,r);if(o){let t=r.substring(r.length-o);e=e.substring(0,e.length-o),r=t+r.substring(0,r.length-o),l=t+l}let s=e,a=r,c=l,h=n(e,r)+n(r,l);for(;r.charAt(0)===l.charAt(0);){e+=r.charAt(0),r=r.substring(1)+l.charAt(0),l=l.substring(1);let t=n(e,r)+n(r,l);t>=h&&(h=t,s=e,a=r,c=l)}t[i-1][1]!==s&&(s?t[i-1][1]=s:(t.splice(i-1,1),i--),t[i][1]=a,c?t[i+1][1]=c:(t.splice(i+1,1),i--))}i++}return t}function eT(e){let t=e.map(e=>em(e));t.push([eA,""]);let n=0,i=0,r=0,l="",o="",s;for(;n<t.length;)switch(t[n][0]){case eR:r++,o+=t[n][1],n++;break;case eS:i++,l+=t[n][1],n++;break;case eA:i+r>1?(0!==i&&0!==r&&(0!==(s=eb(o,l))&&(n-i-r>0&&t[n-i-r-1][0]===eA?t[n-i-r-1][1]+=o.substring(0,s):(t.splice(0,0,[eA,o.substring(0,s)]),n++),o=o.substring(s),l=l.substring(s)),0!==(s=ev(o,l))&&(t[n][1]=o.substring(o.length-s)+t[n][1],o=o.substring(0,o.length-s),l=l.substring(0,l.length-s))),n-=i+r,t.splice(n,i+r),l.length&&(t.splice(n,0,[eS,l]),n++),o.length&&(t.splice(n,0,[eR,o]),n++),n++):0!==n&&t[n-1][0]===eA?(t[n-1][1]+=t[n][1],t.splice(n,1)):n++,r=0,i=0,l="",o="";break;default:throw Error("Unknown diff operation")}""===t[t.length-1][1]&&t.pop();let a=!1;for(n=1;n<t.length-1;)t[n-1][0]===eA&&t[n+1][0]===eA&&(t[n][1].substring(t[n][1].length-t[n-1][1].length)===t[n-1][1]?(t[n][1]=t[n-1][1]+t[n][1].substring(0,t[n][1].length-t[n-1][1].length),t[n+1][1]=t[n-1][1]+t[n+1][1],t.splice(n-1,1),a=!0):t[n][1].substring(0,t[n+1][1].length)===t[n+1][1]&&(t[n-1][1]+=t[n+1][1],t[n][1]=t[n][1].substring(t[n+1][1].length)+t[n+1][1],t.splice(n+1,1),a=!0)),n++;return a&&(t=eT(t)),t}function eC(e,t,n,i,r){let l=e.substring(0,n),o=t.substring(0,i),s=e.substring(n),a=t.substring(i),c=e$(l,o,{checkLines:!1,deadline:r}),h=e$(s,a,{checkLines:!1,deadline:r});return c.concat(h)}function eL(e,t,n){let i=e.slice(n,n+Math.floor(e.length/4)),r=-1,l="",o,s,a,c;for(;-1!==(r=t.indexOf(i,r+1));){let i=eb(e.slice(n),t.slice(r)),h=ev(e.slice(0,n),t.slice(0,r));l.length<h+i&&(l=t.slice(r-h,r)+t.slice(r,r+i),o=e.slice(0,n-h),s=e.slice(n+i),a=t.slice(0,r-h),c=t.slice(r+i))}return 2*l.length>=e.length?[o||"",s||"",a||"",c||"",l||""]:null}let eS=-1,eR=1,eA=0;function eD(e,t,n){var i,r;let l;if(null===e||null===t)throw Error("Null input. (diff)");let o=e$(e,t,{checkLines:!0,deadline:(r=(i=n||{}).timeout||1,l=1,"u">typeof r&&(l=r<=0?Number.MAX_VALUE:r),Date.now()+1e3*l),...i});return function(e){for(let t=0;t<e.length;t++){let[n,i]=e[t];if(0===i.length)continue;let r=i[0];(function(e){let t=e.charCodeAt(0);return t>=55296&&t<=56319})(i[i.length-1])&&n===eA&&eI(e,t,1),function(e){let t=e.charCodeAt(0);return t>=56320&&t<=57343}(r)&&n===eA&&eI(e,t,-1)}for(let t=0;t<e.length;t++)0===e[t][1].length&&e.splice(t,1)}(o),o}function e$(e,t,n){let i=e,r=t;if(i===r)return i?[[eA,i]]:[];let l=eb(i,r),o=i.substring(0,l);l=ev(i=i.substring(l),r=r.substring(l));let s=i.substring(i.length-l),a=function(e,t,n){let i;if(!e)return[[eR,t]];if(!t)return[[eS,e]];let r=e.length>t.length?e:t,l=e.length>t.length?t:e,o=r.indexOf(l);if(-1!==o)return i=[[eR,r.substring(0,o)],[eA,l],[eR,r.substring(o+l.length)]],e.length>t.length&&(i[0][0]=eS,i[2][0]=eS),i;if(1===l.length)return[[eS,e],[eR,t]];let s=function(e,t){let n,i,r,l,o;if((arguments.length>2&&void 0!==arguments[2]?arguments[2]:1)<=0)return null;let s=e.length>t.length?e:t,a=e.length>t.length?t:e;if(s.length<4||2*a.length<s.length)return null;let c=eL(s,a,Math.ceil(s.length/4)),h=eL(s,a,Math.ceil(s.length/2));if(c&&h)n=c[4].length>h[4].length?c:h;else{if(!c&&!h)return null;h?c||(n=h):n=c}if(!n)throw Error("Unable to find a half match.");return e.length>t.length?(i=n[0],r=n[1],l=n[2],o=n[3]):(l=n[0],o=n[1],i=n[2],r=n[3]),[i,r,l,o,n[4]]}(e,t);if(s){let e=s[0],t=s[1],i=s[2],r=s[3],l=s[4],o=e$(e,i,n),a=e$(t,r,n);return o.concat([[eA,l]],a)}return n.checkLines&&e.length>100&&t.length>100?function(e,t,n){let i=e,r=t,l=function(e,t){let n=[],i={};function r(e){let t="",r=0,o=-1,s=n.length;for(;o<e.length-1;){-1===(o=e.indexOf(`
`,r))&&(o=e.length-1);let a=e.slice(r,o+1);(i.hasOwnProperty?i.hasOwnProperty(a):void 0!==i[a])?t+=String.fromCharCode(i[a]):(s===l&&(a=e.slice(r),o=e.length),t+=String.fromCharCode(s),i[a]=s,n[s++]=a),r=o+1}return t}n[0]="";let l=4e4,o=r(e);return l=65535,{chars1:o,chars2:r(t),lineArray:n}}(i,r);i=l.chars1,r=l.chars2;let o=l.lineArray,s=e$(i,r,{checkLines:!1,deadline:n.deadline});(function(e,t){for(let n=0;n<e.length;n++){let i=e[n][1],r=[];for(let e=0;e<i.length;e++)r[e]=t[i.charCodeAt(e)];e[n][1]=r.join("")}})(s,o),(s=function(e){let t=e.map(e=>em(e)),n=!1,i=[],r=0,l=null,o=0,s=0,a=0,c=0,h=0;for(;o<t.length;)t[o][0]===eA?(i[r++]=o,s=c,a=h,c=0,h=0,l=t[o][1]):(t[o][0]===eR?c+=t[o][1].length:h+=t[o][1].length,l&&l.length<=Math.max(s,a)&&l.length<=Math.max(c,h)&&(t.splice(i[r-1],0,[eS,l]),t[i[r-1]+1][0]=eR,r--,o=--r>0?i[r-1]:-1,s=0,a=0,c=0,h=0,l=null,n=!0)),o++;for(n&&(t=eT(t)),t=eM(t),o=1;o<t.length;){if(t[o-1][0]===eS&&t[o][0]===eR){let e=t[o-1][1],n=t[o][1],i=ek(e,n),r=ek(n,e);i>=r?(i>=e.length/2||i>=n.length/2)&&(t.splice(o,0,[eA,n.substring(0,i)]),t[o-1][1]=e.substring(0,e.length-i),t[o+1][1]=n.substring(i),o++):(r>=e.length/2||r>=n.length/2)&&(t.splice(o,0,[eA,e.substring(0,r)]),t[o-1][0]=eR,t[o-1][1]=n.substring(0,n.length-r),t[o+1][0]=eS,t[o+1][1]=e.substring(r),o++),o++}o++}return t}(s)).push([eA,""]);let a=0,c=0,h=0,u="",d="";for(;a<s.length;){switch(s[a][0]){case eR:h++,d+=s[a][1];break;case eS:c++,u+=s[a][1];break;case eA:if(c>=1&&h>=1){s.splice(a-c-h,c+h),a=a-c-h;let e=e$(u,d,{checkLines:!1,deadline:n.deadline});for(let t=e.length-1;t>=0;t--)s.splice(a,0,e[t]);a+=e.length}h=0,c=0,u="",d="";break;default:throw Error("Unknown diff operation.")}a++}return s.pop(),s}(e,t,n):function(e,t,n){let i=e.length,r=t.length,l=Math.ceil((i+r)/2),o=2*l,s=Array(o),a=Array(o);for(let e=0;e<o;e++)s[e]=-1,a[e]=-1;s[l+1]=0,a[l+1]=0;let c=i-r,h=c%2!=0,u=0,d=0,p=0,f=0;for(let g=0;g<l&&!(Date.now()>n);g++){for(let p=-g+u;p<=g-d;p+=2){let f;let y=l+p,m=(f=p===-g||p!==g&&s[y-1]<s[y+1]?s[y+1]:s[y-1]+1)-p;for(;f<i&&m<r&&e.charAt(f)===t.charAt(m);)f++,m++;if(s[y]=f,f>i)d+=2;else if(m>r)u+=2;else if(h){let r=l+c-p;if(r>=0&&r<o&&-1!==a[r]&&f>=i-a[r])return eC(e,t,f,m,n)}}for(let u=-g+p;u<=g-f;u+=2){let d;let y=l+u,m=(d=u===-g||u!==g&&a[y-1]<a[y+1]?a[y+1]:a[y-1]+1)-u;for(;d<i&&m<r&&e.charAt(i-d-1)===t.charAt(r-m-1);)d++,m++;if(a[y]=d,d>i)f+=2;else if(m>r)p+=2;else if(!h){let r=l+c-u;if(r>=0&&r<o&&-1!==s[r]){let o=s[r],a=l+o-r;if(o>=(d=i-d))return eC(e,t,o,a,n)}}}}return[[eS,e],[eR,t]]}(e,t,n.deadline)}(i=i.substring(0,i.length-l),r=r.substring(0,r.length-l),n);return o&&a.unshift([eA,o]),s&&a.push([eA,s]),a=eT(a)}function eB(e,t,n){return 1===n?e+t:t+e}function eP(e,t){return 1===t?[e.substring(0,e.length-1),e[e.length-1]]:[e.substring(1),e[0]]}function eI(e,t,n){var i,r;let l=1===n?-1:1,o=null,s=null,a=t+n;for(;a>=0&&a<e.length&&(null===o||null===s);a+=n){let[i,r]=e[a];if(0!==r.length){if(i===eR){null===o&&(o=a);continue}if(i===eS){null===s&&(s=a);continue}if(i===eA){if(null===o&&null===s){let[i,r]=eP(e[t][1],n);e[t][1]=i,e[a][1]=eB(e[a][1],r,l);return}break}}}if(null!==o&&null!==s&&(i=o,r=s,1===n?e[i][1][e[i][1].length-1]===e[r][1][e[r][1].length-1]:e[i][1][0]===e[r][1][0])){let[i,r]=eP(e[o][1],l),[a]=eP(e[s][1],l);e[o][1]=i,e[s][1]=a,e[t][1]=eB(e[t][1],r,n);return}let[c,h]=eP(e[t][1],n);e[t][1]=c,null===o?(e.splice(a,0,[eR,h]),null!==s&&s>=a&&s++):e[o][1]=eB(e[o][1],h,l),null===s?e.splice(a,0,[eS,h]):e[s][1]=eB(e[s][1],h,l)}let ej={threshold:.5,distance:1e3};function eO(e,t,n){if(null===e||null===t||null===n)throw Error("Null input. (match())");let i=Math.max(0,Math.min(n,e.length));return e===t?0:e.length?e.substring(i,i+t.length)===t?i:function(e,t,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(t.length>32)throw Error("Pattern too long for this browser.");let r={...ej,...i},l=function(e){let t={};for(let n=0;n<e.length;n++)t[e.charAt(n)]=0;for(let n=0;n<e.length;n++)t[e.charAt(n)]|=1<<e.length-n-1;return t}(t);function o(e,i){let l=e/t.length,o=Math.abs(n-i);return r.distance?l+o/r.distance:o?1:l}let s=r.threshold,a=e.indexOf(t,n);-1!==a&&(s=Math.min(o(0,a),s),-1!==(a=e.lastIndexOf(t,n+t.length))&&(s=Math.min(o(0,a),s)));let c=1<<t.length-1;a=-1;let h,u,d=t.length+e.length,p=[];for(let i=0;i<t.length;i++){for(h=0,u=d;h<u;)o(i,n+u)<=s?h=u:d=u,u=Math.floor((d-h)/2+h);d=u;let r=Math.max(1,n-u+1),f=Math.min(n+u,e.length)+t.length,g=Array(f+2);g[f+1]=(1<<i)-1;for(let t=f;t>=r;t--){let h=l[e.charAt(t-1)];if(0===i?g[t]=(g[t+1]<<1|1)&h:g[t]=(g[t+1]<<1|1)&h|((p[t+1]|p[t])<<1|1)|p[t+1],g[t]&c){let e=o(i,t-1);if(e<=s){if(s=e,(a=t-1)>n)r=Math.max(1,2*n-a);else break}}}if(o(i+1,n)>s)break;p=g}return a}(e,t,i):-1}function eY(e,t){return{diffs:[],start1:e,start2:t,utf8Start1:e,utf8Start2:t,length1:0,length2:0,utf8Length1:0,utf8Length2:0}}function ez(e){let t=[];for(let n=0;n<e.length;n++)e[n][0]!==eR&&(t[n]=e[n][1]);return t.join("")}function eW(e){let t=[];for(let n=0;n<e.length;n++)e[n][0]!==eS&&(t[n]=e[n][1]);return t.join("")}function eV(e){let t=0;for(let n=0;n<e.length;n++){let i=e.codePointAt(n);if(typeof i>"u")throw Error("Failed to get codepoint");t+=eF(i)}return t}function eF(e){return e<=127?1:e<=2047?2:e<=65535?3:4}function eJ(e,t){let n=0,i=0,r=0,l=0,o;for(o=0;o<e.length&&(e[o][0]!==eR&&(n+=e[o][1].length),e[o][0]!==eS&&(i+=e[o][1].length),!(n>t));o++)r=n,l=i;return e.length!==o&&e[o][0]===eS?l:l+(t-r)}let eH=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;function eU(e){if(!e)return[];let t=[],n=e.split(`
`),i=0;for(;i<n.length;){let e=n[i].match(eH);if(!e)throw Error("Invalid patch string: ".concat(n[i]));let r=eY(eq(e[1]),eq(e[3]));for(t.push(r),""===e[2]?(r.start1--,r.utf8Start1--,r.length1=1,r.utf8Length1=1):"0"===e[2]?(r.length1=0,r.utf8Length1=0):(r.start1--,r.utf8Start1--,r.utf8Length1=eq(e[2]),r.length1=r.utf8Length1),""===e[4]?(r.start2--,r.utf8Start2--,r.length2=1,r.utf8Length2=1):"0"===e[4]?(r.length2=0,r.utf8Length2=0):(r.start2--,r.utf8Start2--,r.utf8Length2=eq(e[4]),r.length2=r.utf8Length2),i++;i<n.length;){let e;let t=n[i],l=t.charAt(0);if("@"===l)break;if(""===l){i++;continue}try{e=decodeURI(t.slice(1))}catch{throw Error("Illegal escape in parse: ".concat(t))}let o=eV(e)-e.length;if("-"===l)r.diffs.push([eS,e]),r.length1-=o;else if("+"===l)r.diffs.push([eR,e]),r.length2-=o;else if(" "===l)r.diffs.push([eA,e]),r.length1-=o,r.length2-=o;else throw Error('Invalid patch mode "'.concat(l,'" in: ').concat(e));i++}}return t}function eq(e){return parseInt(e,10)}let eG=T("applyPatches"),eK=eG.enabled&&!0;function eX(e){return"object"==typeof e&&"_key"in e}function eZ(e,t){eK&&(eG(`Children ${t}:`,JSON.stringify(e.children,null,2)),eG(`Selection ${t}: `,JSON.stringify(e.selection,null,2)))}function eQ(e,t){let{block:n,path:i}=function(e,t){let n=-1,i=e.children.find((e,i)=>{let r=eX(t[0])?e._key===t[0]._key:i===t[0];return r&&(n=i),r});return i?{block:i,path:[n]}:{}}(e,t);if(!(s.W_.isElement(n)&&"children"===t[1]))return{block:n,blockPath:i,child:void 0,childPath:void 0};let r=-1,l=n.children.find((e,n)=>{let i=eX(t[2])?e._key===t[2]._key:n===t[2];return i&&(r=n),i});return l?{block:n,child:l,blockPath:i,childPath:i?.concat(r)}:{block:n,blockPath:i,child:void 0,childPath:void 0}}let e0=new WeakMap;function e1(e,t){let n=e0.get(e);e0.set(e,!1),t(),e0.set(e,n)}let e2=T("plugin:withUndoRedo"),e8=e2.enabled&&!1,e6=new WeakMap,e3=new WeakMap,e5=e=>{let t=e6.get(e);return void 0===t||t},e4=e=>(e3.get(e)||e3.set(e,[]),e3.get(e)||[]);function e9(e,t,n,i,l){e8&&(e2(`Adjusting '${n.type}' operation paths for '${t.type}' patch`),e2(`Operation ${JSON.stringify(n)}`),e2(`Patch ${JSON.stringify(t)}`));let o={...n};if("insert"===t.type&&1===t.path.length){let e=(i||[]).findIndex(e=>r({_key:e._key},t.path[0]));return e2(`Adjusting block path (+${t.items.length}) for '${o.type}' operation and patch '${t.type}'`),[e7(o,t.items.length,e)]}if("unset"===t.type&&1===t.path.length){let n=(l||[]).findIndex(e=>r({_key:e._key},t.path[0]));return"path"in o&&Array.isArray(o.path)&&o.path[0]===n?(e2("Skipping transformation that targeted removed block"),[]):(e8&&(e2(`Selection ${JSON.stringify(e.selection)}`),e2(`Adjusting block path (-1) for '${o.type}' operation and patch '${t.type}'`)),[e7(o,-1,n)])}if("unset"===t.type&&0===t.path.length)return e2(`Adjusting selection for unset everything patch and ${n.type} operation`),[];if("diffMatchPatch"===t.type){let n;let i=("set_selection"===o.type&&e.selection?n=e.children[e.selection.focus.path[0]]:"path"in o&&(n=e.children[o.path[0]]),n);return i&&r({_key:i._key},t.path[0])&&eU(t.value).forEach(e=>{let t=0,n=e.utf8Start1,{diffs:i}=e;if(i.forEach((e,r)=>{let[l,o]=e;l===eR?(t+=o.length,n+=o.length):l===eS?(t-=o.length,n-=o.length):l===eA&&(i.slice(r).every(([e])=>e===eA)||(n+=o.length))}),"insert_text"===o.type&&n<o.offset&&(o.offset+=t),"remove_text"===o.type&&n<=o.offset-o.text.length&&(o.offset+=t),"set_selection"===o.type){let e=o.properties?.focus?{...o.properties.focus}:void 0,i=o?.properties?.anchor?{...o.properties.anchor}:void 0,r=o?.newProperties?.focus?{...o.newProperties.focus}:void 0,l=o?.newProperties?.anchor?{...o.newProperties.anchor}:void 0;(e&&i||r&&l)&&([e,i,r,l].forEach(e=>{e&&n<e.offset&&(e.offset+=t)}),e&&i&&(o.properties={focus:e,anchor:i}),r&&l&&(o.newProperties={focus:r,anchor:l}))}}),[o]}return[o]}function e7(e,t,n){let i={...e};if(n>=0&&"set_selection"!==i.type&&Array.isArray(i.path)&&i.path[0]>=n+t&&i.path[0]+t>-1){let e=[i.path[0]+t,...i.path.slice(1)];i.path=e}if("set_selection"===i.type){let e=i.properties?.focus?{...i.properties.focus}:void 0,r=i?.properties?.anchor?{...i.properties.anchor}:void 0,l=i?.newProperties?.focus?{...i.newProperties.focus}:void 0,o=i?.newProperties?.anchor?{...i.newProperties.anchor}:void 0;(e&&r||l&&o)&&([e,r,l,o].forEach(e=>{e&&e.path[0]>=n+t&&e.path[0]+t>-1&&(e.path=[e.path[0]+t,...e.path.slice(1)])}),e&&r&&(i.properties={focus:e,anchor:r}),l&&o&&(i.newProperties={focus:l,anchor:o}))}return i}let te=(e,t)=>!!("set_selection"===e.type||t&&"insert_text"===e.type&&"insert_text"===t.type&&e.offset===t.offset+t.text.length&&s.y$.equals(e.path,t.path)&&" "!==e.text||t&&"remove_text"===e.type&&"remove_text"===t.type&&e.offset+e.text.length===t.offset&&s.y$.equals(e.path,t.path)),tt=(e,t)=>!!(t&&"set_selection"===e.type&&"set_selection"===t.type),tn=e=>"set_selection"!==e.type;function ti(e,t){let n=e5(e);e6.set(e,!1),t(),e6.set(e,n)}let tr=T("plugin:withPatches"),tl=T("plugin:withPlaceholderBlock"),to=T("plugin:withPortableTextBlockStyle"),ts=T("plugin:withPortableTextLists"),ta=T("plugin:withPortableTextMarkModel"),tc=T("plugin:withPortableTextSelections"),th=tc.enabled&&!1,tu=T("plugin:withSchemaTypes"),td=T("plugin:withUtils"),tp=T("plugin:withHotKeys"),tf={marks:{"mod+b":"strong","mod+i":"em","mod+u":"underline","mod+'":"code"},custom:{}};function tg(e,t,n){let i=null,r=!0,l=[t.span.name,...t.inlineObjects.map(e=>e.name)],o=[t.block.name,...t.blockObjects.map(e=>e.name)];return void 0===e?{valid:!0,resolution:null,value:e}:Array.isArray(e)&&0!==e.length?(e.some((e,s)=>{if(!_(e))return i={patches:[(0,g.zN)([s])],description:`Block must be an object, got ${String(e)}`,action:"Unset invalid item",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-object.description",action:"inputs.portable-text.invalid-value.not-an-object.action",values:{index:s}}},!0;if(!e._key||"string"!=typeof e._key)return i={patches:[(0,g.t8)({...e,_key:n()},[s])],description:`Block at index ${s} is missing required _key.`,action:"Set the block with a random _key value",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-key.description",action:"inputs.portable-text.invalid-value.missing-key.action",values:{index:s}}},!0;if(!e._type||!o.includes(e._type)){if("block"===e._type){let n=t.block.name;return i={patches:[(0,g.t8)({...e,_type:n},[{_key:e._key}])],description:`Block with _key '${e._key}' has invalid type name '${e._type}'. According to the schema, the block type name is '${n}'`,action:`Use type '${n}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.incorrect-block-type.description",action:"inputs.portable-text.invalid-value.incorrect-block-type.action",values:{key:e._key,expectedTypeName:n}}},!0}return i=!e._type&&(0,h.DG)({...e,_type:t.block.name})?{patches:[(0,g.t8)({...e,_type:t.block.name},[{_key:e._key}])],description:`Block with _key '${e._key}' is missing a type name. According to the schema, the block type name is '${t.block.name}'`,action:`Use type '${t.block.name}'`,item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-block-type.description",action:"inputs.portable-text.invalid-value.missing-block-type.action",values:{key:e._key,expectedTypeName:t.block.name}}}:e._type?{patches:[(0,g.zN)([{_key:e._key}])],description:`Block with _key '${e._key}' has invalid _type '${e._type}'`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-type.description",action:"inputs.portable-text.invalid-value.disallowed-type.action",values:{key:e._key,typeName:e._type}}}:{patches:[(0,g.zN)([{_key:e._key}])],description:`Block with _key '${e._key}' is missing an _type property`,action:"Remove the block",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-type.description",action:"inputs.portable-text.invalid-value.missing-type.action",values:{key:e._key}}},!0}if(e._type===t.block.name){if(e.children&&!Array.isArray(e.children))return i={patches:[(0,g.t8)({children:[]},[{_key:e._key}])],description:`Text block with _key '${e._key}' has a invalid required property 'children'.`,action:"Reset the children property",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-children.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-children.action",values:{key:e._key}}},!0;if(void 0===e.children||Array.isArray(e.children)&&0===e.children.length){let r={_type:t.span.name,_key:n(),text:"",marks:[]};return i={autoResolve:!0,patches:[(0,g.Cb)([],[{_key:e._key},"children"]),(0,g.$T)([r],"after",[{_key:e._key},"children",0])],description:`Children for text block with _key '${e._key}' is empty.`,action:"Insert an empty text",item:e,i18n:{description:"inputs.portable-text.invalid-value.empty-children.description",action:"inputs.portable-text.invalid-value.empty-children.action",values:{key:e._key}}},!0}if(e.markDefs&&!Array.isArray(e.markDefs))return i={patches:[(0,g.t8)({...e,markDefs:D},[{_key:e._key}])],description:"Block has invalid required property 'markDefs'.",action:"Add empty markDefs array",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-or-invalid-markdefs.description",action:"inputs.portable-text.invalid-value.missing-or-invalid-markdefs.action",values:{key:e._key}}},!0;let o=d(b(e.children.filter(e=>e._type===t.span.name).map(e=>e.marks||[])));if(Array.isArray(e.markDefs)&&e.markDefs.length>0){let t=d(e.markDefs.map(e=>e._key).filter(e=>!o.includes(e)));if(t.length>0)return i={autoResolve:!0,patches:t.map(t=>(0,g.zN)([{_key:e._key},"markDefs",{_key:t}])),description:`Block contains orphaned data (unused mark definitions): ${t.join(", ")}.`,action:"Remove unused mark definition item",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-mark-defs.description",action:"inputs.portable-text.invalid-value.orphaned-mark-defs.action",values:{key:e._key,unusedMarkDefs:t.map(e=>e.toString())}}},!0}let s=o.filter(e=>!t.decorators.map(e=>e.value).includes(e)).filter(t=>void 0===e.markDefs||!e.markDefs.find(e=>e._key===t));if(s.length>0){let n=e.children.filter(e=>e._type===t.span.name&&Array.isArray(e.marks)&&e.marks.some(e=>s.includes(e)));if(n){let t=s.join(", ");return i={autoResolve:!0,patches:n.map(t=>(0,g.t8)((t.marks||[]).filter(e=>!s.includes(e)),[{_key:e._key},"children",{_key:t._key},"marks"])),description:`Block with _key '${e._key}' contains marks (${t}) not supported by the current content model.`,action:"Remove invalid marks",item:e,i18n:{description:"inputs.portable-text.invalid-value.orphaned-marks.description",action:"inputs.portable-text.invalid-value.orphaned-marks.action",values:{key:e._key,orphanedMarks:s.map(e=>e.toString())}}},!0}}e.children.some((r,o)=>{if(!_(r))return i={patches:[(0,g.zN)([{_key:e._key},"children",o])],description:`Child at index '${o}' in block with key '${e._key}' is not an object.`,action:"Remove the item",item:e,i18n:{description:"inputs.portable-text.invalid-value.non-object-child.description",action:"inputs.portable-text.invalid-value.non-object-child.action",values:{key:e._key,index:o}}},!0;if(!r._key||"string"!=typeof r._key){let t={...r,_key:n()};return i={autoResolve:!0,patches:[(0,g.t8)(t,[{_key:e._key},"children",o])],description:`Child at index ${o} is missing required _key in block with _key ${e._key}.`,action:"Set a new random _key on the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-key.description",action:"inputs.portable-text.invalid-value.missing-child-key.action",values:{key:e._key,index:o}}},!0}return r._type?l.includes(r._type)?r._type===t.span.name&&"string"!=typeof r.text&&(i={patches:[(0,g.t8)({...r,text:""},[{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has missing or invalid text property!`,action:"Write an empty text property to the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.invalid-span-text.description",action:"inputs.portable-text.invalid-value.invalid-span-text.action",values:{key:e._key,childKey:r._key}}},!0):(i={patches:[(0,g.zN)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' has invalid '_type' property (${r._type}).`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.disallowed-child-type.description",action:"inputs.portable-text.invalid-value.disallowed-child-type.action",values:{key:e._key,childKey:r._key,childType:r._type}}},!0):(i={patches:[(0,g.zN)([{_key:e._key},"children",{_key:r._key}])],description:`Child with _key '${r._key}' in block with key '${e._key}' is missing '_type' property.`,action:"Remove the object",item:e,i18n:{description:"inputs.portable-text.invalid-value.missing-child-type.description",action:"inputs.portable-text.invalid-value.missing-child-type.action",values:{key:e._key,childKey:r._key}}},!0)})&&(r=!1)}return!1})&&(r=!1),{valid:r,resolution:i,value:e}):{valid:!1,resolution:{patches:[(0,g.zN)([])],description:"Editor value must be an array of Portable Text blocks, or undefined.",action:"Unset the value",item:e,i18n:{description:"inputs.portable-text.invalid-value.not-an-array.description",action:"inputs.portable-text.invalid-value.not-an-array.action"}},value:e}}let ty=T("plugin:withInsertData"),tm={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function tk(e,t,n){e.withoutNormalizing(()=>{if(!e.selection)return;let[i,l]=s.ML.node(e,e.selection,{depth:1});if(e.isTextBlock(i)&&e.isTextBlock(t[0])){let{markDefs:n}=i;ty("Mixing markDefs of focusBlock and fragments[0] block",n,t[0].markDefs),r(n,t[0].markDefs)||s.YR.setNodes(e,{markDefs:d([...t[0].markDefs||[],...n||[]])},{at:l,mode:"lowest",voids:!1})}j(e.children,n)?(s.YR.splitNodes(e,{at:[0,0]}),e.insertFragment(t),s.YR.removeNodes(e,{at:[0]})):e.insertFragment(t)}),e.onChange()}let tb=new WeakMap,tv=(e,t)=>{var n;let i;let{keyGenerator:o,portableTextEditor:c,patches$:u,readOnly:p,maxBlocks:f}=t,{schemaTypes:v,change$:x}=c;e.subscriptions=[],e.destroy?e.destroy():tb.set(e,{apply:e.apply,onChange:e.onChange,normalizeNode:e.normalizeNode});let _=function(e){let t=e.block.name;return{insertNodePatch:function(e,n,i){let r=i[n.path[0]],l=e.isTextBlock(r);if(1===n.path.length){let e=0===n.path[0]?"before":"after",l=i[n.path[0]-1],o=0===n.path[0]?r?._key:l?._key;return o?[(0,g.$T)([I([n.node],t)[0]],e,[{_key:o}])]:[(0,g.Cb)(i,[]),(0,g.$T)([I([n.node],t)[0]],"before",[n.path[0]])]}if(l&&2===n.path.length&&e.children[n.path[0]]){let e=0!==r.children.length&&r.children[n.path[1]-1]?"after":"before",i={...n.node};!i._type&&s.xv.isText(i)&&(i._type="span",i.marks=[]);let l=I([{_key:"bogus",_type:t,children:[i]}],t)[0].children[0];return[(0,g.$T)([l],e,[{_key:r._key},"children",r.children.length<=1||!r.children[n.path[1]-1]?0:{_key:r.children[n.path[1]-1]._key}])]}return ec("Something was inserted into a void block. Not producing editor patches."),[]},insertTextPatch:function(e,t,n){ec.enabled&&ec("Operation",JSON.stringify(t,null,2));let i=e.isTextBlock(e.children[t.path[0]])&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&e.isTextSpan(i.children[t.path[1]])&&i.children[t.path[1]];if(!r)throw Error("Could not find child");let l=[{_key:i._key},"children",{_key:r._key},"text"],o=n[t.path[0]],s=e.isTextBlock(o)&&o.children[t.path[1]],a=e.isTextSpan(s)?s.text:"",c=(0,g.aH)(a,r.text,l);return c.value.length?[c]:[]},mergeNodePatch:function(e,n,i){let r=[],l=i[n.path[0]],o=e.children[n.path[0]];if(1===n.path.length){if(l?._key){let i=I([e.children[n.path[0]-1]],t)[0];r.push((0,g.t8)(i,[{_key:i._key}])),r.push((0,g.zN)([{_key:l._key}]))}else throw Error("Target key not found!")}else if(e.isTextBlock(l)&&e.isTextBlock(o)&&2===n.path.length){let t=o.children[n.path[1]-1]&&e.isTextSpan(o.children[n.path[1]-1])?o.children[n.path[1]-1]:void 0,i=l.children[n.path[1]]&&e.isTextSpan(l.children[n.path[1]])?l.children[n.path[1]]:void 0;t&&(1===l.children.filter(e=>e._key===t._key).length?r.push((0,g.t8)(t.text,[{_key:l._key},"children",{_key:t._key},"text"])):console.warn(`Multiple spans have \`_key\` ${t._key}. It's ambiguous which one to update.`,JSON.stringify(l,null,2))),i&&(1===l.children.filter(e=>e._key===i._key).length?r.push((0,g.zN)([{_key:l._key},"children",{_key:i._key}])):console.warn(`Multiple spans have \`_key\` ${i._key}. It's ambiguous which one to remove.`,JSON.stringify(l,null,2)))}else ec("Void nodes can't be merged, not creating any patches");return r},moveNodePatch:function(e,n,i){let r=[],l=i[n.path[0]],o=i[n.newPath[0]];if(1===n.path.length){let e=n.path[0]>n.newPath[0]?"before":"after";r.push((0,g.zN)([{_key:l._key}])),r.push((0,g.$T)([I([l],t)[0]],e,[{_key:o._key}]))}else if(2===n.path.length&&e.isTextBlock(l)&&e.isTextBlock(o)){let e=l.children[n.path[1]],i=o.children[n.newPath[1]],s=n.newPath[1]===o.children.length?"after":"before",a=I([l],t)[0].children[n.path[1]];r.push((0,g.zN)([{_key:l._key},"children",{_key:e._key}])),r.push((0,g.$T)([a],s,[{_key:o._key},"children",{_key:i._key}]))}return r},removeNodePatch:function(e,t,n){let i=n[t.path[0]];if(1===t.path.length){if(i&&i._key)return[(0,g.zN)([{_key:i._key}])];throw Error("Block not found")}if(!e.isTextBlock(i)||2!==t.path.length)return ec("Not creating patch inside object block"),[];{let e=i.children[t.path[1]];return e?i.children.filter(e=>e._key===t.node._key).length>1?(console.warn(`Multiple spans have \`_key\` ${t.node._key}. It's ambiguous which one to remove.`,JSON.stringify(i,null,2)),[]):[(0,g.zN)([{_key:i._key},"children",{_key:e._key}])]:(ec("Span not found in editor trying to remove node"),[])}},removeTextPatch:function(e,t,n){let i=e&&e.children[t.path[0]];if(!i)throw Error("Could not find block");let r=e.isTextBlock(i)&&i.children[t.path[1]]||void 0,l=e.isTextSpan(r)?r:void 0;if(r&&!l)throw Error("Expected span");if(!l)throw Error("Could not find child");let o=[{_key:i._key},"children",{_key:l._key},"text"],s=n[t.path[0]],a=e.isTextBlock(s)&&s.children[t.path[1]],c=e.isTextSpan(a)&&a.text,h=(0,g.aH)(c||"",l.text,o);return h.value?[h]:[]},setNodePatch:function(e,n){if(1===n.path.length){let i=e.children[n.path[0]];if("string"!=typeof i._key)throw Error("Expected block to have a _key");let r=k({...e.children[n.path[0]],...n.newProperties},m);return[(0,g.t8)(I([r],t)[0],[{_key:i._key}])]}if(2===n.path.length){let t=e.children[n.path[0]];if(e.isTextBlock(t)){let e=t.children[n.path[1]];if(e){let i=t._key,r=e._key,l=[],o=Object.keys(n.newProperties);return o.forEach(s=>{if(1===o.length&&"_key"===s){let r=y(n.newProperties,s);l.push((0,g.t8)(r,[{_key:i},"children",t.children.indexOf(e),s]))}else{let e=y(n.newProperties,s);l.push((0,g.t8)(e,[{_key:i},"children",{_key:r},s]))}}),l}throw Error("Could not find a valid child")}throw Error("Could not find a valid block")}throw Error(`Unexpected path encountered: ${JSON.stringify(n.path)}`)},splitNodePatch:function(e,n,i){let r=[],l=e.children[n.path[0]];if(!e.isTextBlock(l))throw Error(`Block with path ${JSON.stringify(n.path[0])} is not a text block and can't be split`);if(1===n.path.length){let o=i[n.path[0]];if(e.isTextBlock(o)){let i=I([e.children[n.path[0]+1]],t)[0];i&&(r.push((0,g.$T)([i],"after",[{_key:l._key}])),o.children.slice(n.position).forEach(e=>{let t=[{_key:o._key},"children",{_key:e._key}];r.push((0,g.zN)(t))}))}return r}if(2===n.path.length){let i=l.children[n.path[1]];if(e.isTextSpan(i)){let e=I([{...l,children:l.children.slice(n.path[1]+1,n.path[1]+2)}],t)[0].children;r.push((0,g.$T)(e,"after",[{_key:l._key},"children",{_key:i._key}])),r.push((0,g.t8)(i.text,[{_key:l._key},"children",{_key:i._key},"text"]))}}return r}}}(v),N=function(e){let{apply:t,normalizeNode:n}=e;return e.apply=n=>{if(ed(e)||eg(e)||ey(e)){t(n);return}if("split_node"===n.type){t({...n,properties:{...n.properties,_key:o()}});return}if("insert_node"===n.type&&!s.ML.isEditor(n.node)){t({...n,node:{...n.node,_key:o()}});return}t(n)},e.normalizeNode=t=>{let[i,r]=t;if(s.W_.isElement(i)&&i._type===v.block.name){for(let[t,n]of(i._key||s.YR.setNodes(e,{_key:o()},{at:r}),s.NB.children(e,r)))if(!t._key){s.YR.setNodes(e,{_key:o()},{at:n});return}}n(t)},e},w=function({schemaTypes:e,keyGenerator:t}){return function(n){n.isTextBlock=t=>(0,h.DG)(t)&&t._type===e.block.name,n.isTextSpan=t=>(0,h.NG)(t)&&t._type==e.span.name,n.isListBlock=t=>(0,h.KA)(t)&&t._type===e.block.name,n.isVoid=t=>e.block.name!==t._type&&(e.blockObjects.map(e=>e.name).includes(t._type)||e.inlineObjects.map(e=>e.name).includes(t._type)),n.isInline=t=>e.inlineObjects.map(e=>e.name).includes(t._type)&&"__inline"in t&&!0===t.__inline;let{normalizeNode:i}=n;return n.normalizeNode=r=>{let[l,o]=r;if(void 0===l._type&&2===o.length){tu("Setting span type on text node without a type");let i=l._key||t();s.YR.setNodes(n,{...l,_type:e.span.name,_key:i},{at:o})}if(void 0===l._key&&(1===o.length||2===o.length)){tu("Setting missing key on child node without a key");let e=t();s.YR.setNodes(n,{_key:e},{at:o})}i(r)},n}}({schemaTypes:v,keyGenerator:o}),E=function(e){return c.setEditable({focus:()=>{a.F3.focus(e)},blur:()=>{a.F3.blur(e)},toggleMark:t=>{e.pteToggleMark(t)},toggleList:t=>{e.pteToggleListItem(t)},toggleBlockStyle:t=>{e.pteToggleBlockStyle(t)},isMarkActive:t=>{try{return e.pteIsMarkActive(t)}catch(e){return console.warn(e),!1}},marks:()=>({...s.ML.marks(e)||{}}).marks||[],undo:()=>e.undo(),redo:()=>e.redo(),select:t=>{let n=R(t,e);n?s.YR.select(e,n):s.YR.deselect(e),e.onChange()},focusBlock:()=>{if(e.selection){let t=s.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t)return I([t],v.block.name,H.get(e))[0]}},focusChild:()=>{if(e.selection){let t=s.NB.descendant(e,e.selection.focus.path.slice(0,1));if(t&&e.isTextBlock(t))return I([t],v.block.name,H.get(e))[0].children[e.selection.focus.path[1]]}},insertChild:(t,n)=>{if(!e.selection)throw Error("The editor has no selection");let[i]=Array.from(s.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===v.block.name}))[0]||[void 0];if(!i)throw Error("No focused text block");if(t.name!==v.span.name&&!v.inlineObjects.some(e=>e.name===t.name))throw Error("This type cannot be inserted as a child to a text block");let r=P([{_key:o(),_type:v.block.name,children:[{_key:o(),_type:t.name,...n||{}}]}],c)[0].children[0],l=e.selection.focus.path.slice(0,2),a=r._type===v.span.name,h=s.NB.get(e,l);return a&&h._type!==v.span.name&&(eh("Inserting span child next to inline object child, moving selection + 1"),e.move({distance:1,unit:"character"})),s.YR.insertNodes(e,r,{select:!0,at:e.selection}),e.onChange(),S(I(e.children,v.block.name,H.get(e)),e.selection,v)?.focus.path||[]},insertBlock:(t,n)=>{let i=P([{_key:o(),_type:t.name,...n||{}}],c)[0];if(!e.selection){let t=Array.from(s.ML.nodes(e,{match:e=>!s.ML.isEditor(e),at:[],reverse:!0}))[0];return s.ML.insertNode(e,i),t&&j([t[0]],v)&&s.YR.removeNodes(e,{at:t[1]}),e.onChange(),S(I(e.children,v.block.name,H.get(e)),e.selection,v)?.focus.path??[]}let r=Array.from(s.ML.nodes(e,{at:e.selection.focus.path.slice(0,1),match:e=>e._type===v.block.name}))[0];return s.ML.insertNode(e,i),r&&j([r[0]],v)&&s.YR.removeNodes(e,{at:r[1]}),e.onChange(),S(I(e.children,v.block.name,H.get(e)),e.selection,v)?.focus.path||[]},hasBlockStyle:t=>{try{return e.pteHasBlockStyle(t)}catch{return!1}},hasListStyle:t=>{try{return e.pteHasListStyle(t)}catch{return!1}},isVoid:e=>![v.block.name,v.span.name].includes(e._type),findByPath:t=>{let n=R({focus:{path:t,offset:0},anchor:{path:t,offset:0}},e);if(n){let[i,r]=s.ML.node(e,n.focus.path.slice(0,1));if(i&&r&&"string"==typeof i._key){if(1===t.length&&1===n.focus.path.length)return[I([i],v.block.name)[0],[{_key:i._key}]];let r=I([i],v.block.name,H.get(e))[0];if(e.isTextBlock(r)){let e=r.children[n.focus.path[1]];if(e)return[e,[{_key:i._key},"children",{_key:e._key}]]}}}return[void 0,void 0]},findDOMNode:t=>{let n;try{let[i]=Array.from(s.ML.nodes(e,{at:[],match:e=>e._key===t._key})||[])[0]||[void 0];n=a.F3.toDOMNode(e,i)}catch{}return n},activeAnnotations:()=>{if(!e.selection||e.selection.focus.path.length<2)return[];try{let t=[];for(let[n,i]of s.ML.nodes(e,{at:e.selection,match:e=>s.xv.isText(e)&&void 0!==e.marks&&Array.isArray(e.marks)&&e.marks.length>0})){let[r]=s.ML.node(e,i,{depth:1});e.isTextBlock(r)&&r.markDefs?.forEach(e=>{s.xv.isText(n)&&n.marks&&Array.isArray(n.marks)&&n.marks.includes(e._key)&&t.push(e)})}return t}catch{return[]}},isAnnotationActive:t=>{if(!e.selection||e.selection.focus.path.length<2)return!1;try{let n=[...s.ML.nodes(e,{at:e.selection,match:e=>s.xv.isText(e)})];if(0===n.length||n.some(([e])=>!(0,h.NG)(e)||!e.marks||e.marks?.length===0))return!1;let i=n.reduce((t,[,n])=>{let[i]=s.ML.node(e,n,{depth:1});return e.isTextBlock(i)&&i.markDefs?[...t,...i.markDefs]:t},[]);return n.every(([e])=>!!(0,h.NG)(e)&&e.marks?.map(e=>i.find(t=>t?._key===e)?._type)?.includes(t))}catch{return!1}},addAnnotation:(t,n)=>{let i;let{selection:r}=e;if(r){let[l]=s.ML.node(e,r.focus,{depth:1});if(!e.isTextBlock(l))return;let[a]=s.ML.node(e,r.focus,{depth:2});if(!(0,h.NG)(a)||""===a.text)return;s.e6.isCollapsed(r)&&(e.pteExpandToWord(),e.onChange()),e.selection&&(s.ML.withoutNormalizing(e,()=>{let c=o();s.YR.setNodes(e,{markDefs:[...l.markDefs||[],{_type:t.name,_key:c,...n}]},{at:r.focus}),e.onChange(),s.YR.setNodes(e,{},{match:s.xv.isText,split:!0}),e.onChange(),e.selection&&s.xv.isText(a)&&s.YR.setNodes(e,{marks:[...a.marks||[],c]},{at:e.selection,match:e=>e._type===v.span.name}),e.onChange();let h=S(I(e.children,v.block.name,H.get(e)),e.selection,v);h&&(i={spanPath:h.focus.path,markDefPath:[{_key:l._key},"markDefs",{_key:c}]})}),s.ML.normalize(e),e.onChange())}return i},delete:(t,n)=>{if(t){let i=R(t,e);if(!(i&&i.anchor.path.length>0&&i.focus.path.length>0))throw Error("Invalid range");if(i){if(!n?.mode||n?.mode==="selected"){eh("Deleting content in selection"),s.YR.delete(e,{at:i,hanging:!0,voids:!0}),e.onChange();return}n?.mode==="blocks"&&(eh("Deleting blocks touched by selection"),s.YR.removeNodes(e,{at:i,voids:!0,match:t=>e.isTextBlock(t)||!e.isTextBlock(t)&&s.W_.isElement(t)})),n?.mode==="children"&&(eh("Deleting children touched by selection"),s.YR.removeNodes(e,{at:i,voids:!0,match:t=>t._type===v.span.name||!e.isTextBlock(t)&&s.W_.isElement(t)})),0===e.children.length&&(e.children=[e.pteCreateEmptyBlock()]),e.onChange()}}},removeAnnotation:t=>{let{selection:n}=e;if(eh("Removing annotation",t),n){if(s.e6.isCollapsed(n)){let[t,i]=s.ML.node(e,n,{depth:2});s.xv.isText(t)&&t.marks&&"string"==typeof t.text&&(s.YR.select(e,i),n=e.selection)}s.ML.withoutNormalizing(e,()=>{n&&s.e6.isExpanded(n)&&(n=e.selection)&&[...s.ML.nodes(e,{at:n,match:n=>e.isTextBlock(n)&&Array.isArray(n.markDefs)&&n.markDefs.some(e=>e._type===t.name)})].forEach(([n])=>{e.isTextBlock(n)&&Array.isArray(n.markDefs)&&n.markDefs.filter(e=>e._type===t.name).forEach(t=>{s.ML.removeMark(e,t._key)})})}),s.ML.normalize(e),e.onChange()}},getSelection:()=>{let t=null;if(e.selection){let n=U.get(e.selection);if(n)return n;t=S(I(e.children,v.block.name,H.get(e)),e.selection,v),U.set(e.selection,t)}return t},getValue:()=>I(e.children,v.block.name,H.get(e)),isCollapsedSelection:()=>!!e.selection&&s.e6.isCollapsed(e.selection),isExpandedSelection:()=>!!e.selection&&s.e6.isExpanded(e.selection),insertBreak:()=>{e.insertBreak(),e.onChange()},getFragment:()=>I(e.getFragment(),v.block.name),isSelectionsOverlapping:(t,n)=>{let i=R(t,e),r=R(n,e);return s.e6.isRange(i)&&s.e6.isRange(r)&&s.e6.includes(i,r)}}),e},M=function({change$:e,patches$:t,patchFunctions:n,readOnly:i,schemaTypes:r}){let l,o;let a=function(e,t){let n=!1;eK&&(eG(`

NEW PATCH =============================================================`),eG(JSON.stringify(t,null,2)));try{switch(t.type){case"insert":n=function(e,t,n){let{block:i,child:r,blockPath:l,childPath:o}=eQ(e,t.path);if(!i||!l)return eG("Block not found"),!1;if(t.path.length>1&&"children"!==t.path[1])return eG("Ignoring patch targeting void value"),!1;if(1===t.path.length){let{items:i,position:r}=t,o=P(i,{schemaTypes:n},J.get(e)),a=l[0],c="after"===r?a+1:a;return eG(`Inserting blocks at path [${c}]`),eZ(e,"before"),s.YR.insertNodes(e,o,{at:[c]}),eZ(e,"after"),!0}let{items:a,position:c}=t;if(!r||!o)return eG("Child not found"),!1;let h=i&&P([{...i,children:a}],{schemaTypes:n},J.get(e)),u=o[1],d=[o[0],"after"===c?u+1:u];return eG(`Inserting children at path ${d}`),eZ(e,"before"),h&&s.W_.isElement(h[0])&&s.YR.insertNodes(e,h[0].children,{at:d}),eZ(e,"after"),!0}(e,t,r);break;case"unset":n=function(e,t,n){if(0===t.path.length){eG("Removing everything"),eZ(e,"before");let t=e.selection;return s.YR.deselect(e),e.children.forEach((t,n)=>{s.YR.removeNodes(e,{at:[n]})}),s.YR.insertNodes(e,e.pteCreateEmptyBlock()),t&&s.YR.select(e,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),e.onChange(),eZ(e,"after"),!0}let{block:i,blockPath:r,child:l,childPath:o}=eQ(e,t.path);if(1===t.path.length){if(!i||!r)return eG("Block not found"),!1;let t=r[0];return eG(`Removing block at path [${t}]`),eZ(e,"before"),s.YR.removeNodes(e,{at:[t]}),eZ(e,"after"),!0}return!!e.isTextBlock(i)&&"children"===t.path[1]&&3===t.path.length&&(l&&o?(eG(`Unsetting child at path ${JSON.stringify(o)}`),eZ(e,"before"),eK&&eG(`Removing child at path ${JSON.stringify(o)}`),s.YR.removeNodes(e,{at:o}),eZ(e,"after"),!0):(eG("Child not found"),!1))}(e,t,0);break;case"set":n=function(e,t){let n=t.value;"string"==typeof t.path[3]&&((n={})[t.path[3]]=t.value);let{block:i,blockPath:r,child:l,childPath:o}=eQ(e,t.path);if(!i)return eG("Block not found"),!1;let a=e.isTextBlock(i);if(a&&t.path.length>1&&"children"!==t.path[1])return eG("Ignoring setting void value"),!1;if(eZ(e,"before"),a&&l&&o){if(s.xv.isText(n)&&s.xv.isText(l)){let t=l.text;n.text!==t&&(eG("Setting text property"),e.apply({type:"remove_text",path:o,offset:0,text:t}),e.apply({type:"insert_text",path:o,offset:0,text:n.text}),e.onChange())}else eG("Setting non-text property"),e.apply({type:"set_node",path:o,properties:{},newProperties:n});return!0}if(s.W_.isElement(i)&&1===t.path.length&&r){eG("Setting block property");let{children:t,...l}=n,{children:o,...s}=i||{children:void 0};e.apply({type:"set_node",path:r,properties:{...s},newProperties:l}),eG("Setting children"),i.children.forEach((t,n)=>{e.apply({type:"remove_node",path:r.concat(i.children.length-1-n),node:t})}),Array.isArray(t)&&t.forEach((t,n)=>{e.apply({type:"insert_node",path:r.concat(n),node:t})})}else if(i&&"value"in i){let n=(0,g.g7)([i.value],[t])[0];return s.YR.setNodes(e,{...i,value:n},{at:r}),!0}return eZ(e,"after"),!0}(e,t);break;case"diffMatchPatch":n=function(e,t){let{block:n,child:i,childPath:r}=eQ(e,t.path);if(!n)return eG("Block not found"),!1;if(!i||!r)return eG("Child not found"),!1;if(!(n&&e.isTextBlock(n)&&4===t.path.length&&"children"===t.path[1]&&"text"===t.path[3])||!s.xv.isText(i))return!1;let[l]=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if("string"==typeof e)throw Error("Patches must be an array - pass the patch to `parsePatch()` first");let i=t;if(0===e.length)return[i,[]];let r=function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=0,r=0;function l(e){for(;i<e;){let e=t.codePointAt(r);if(typeof e>"u")return r;i+=eF(e),e>65535?r+=2:r+=1}if(!n.allowExceedingIndices&&i!==e)throw Error("Failed to determine byte offset");return r}let o=[];for(let t of e)o.push({diffs:t.diffs.map(e=>em(e)),start1:l(t.start1),start2:l(t.start2),utf8Start1:t.utf8Start1,utf8Start2:t.utf8Start2,length1:t.length1,length2:t.length2,utf8Length1:t.utf8Length1,utf8Length2:t.utf8Length2});return o}(e,i,{allowExceedingIndices:n.allowExceedingIndices}),l=n.margin||4,o=n.deleteThreshold||.4,s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n="";for(let e=1;e<=t;e++)n+=String.fromCharCode(e);for(let n of e)n.start1+=t,n.start2+=t,n.utf8Start1+=t,n.utf8Start2+=t;let i=e[0],r=i.diffs;if(0===r.length||r[0][0]!==eA)r.unshift([eA,n]),i.start1-=t,i.start2-=t,i.utf8Start1-=t,i.utf8Start2-=t,i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[0][1].length){let e=r[0][1].length,l=t-e;r[0][1]=n.substring(e)+r[0][1],i.start1-=l,i.start2-=l,i.utf8Start1-=l,i.utf8Start2-=l,i.length1+=l,i.length2+=l,i.utf8Length1+=l,i.utf8Length2+=l}if(0===(r=(i=e[e.length-1]).diffs).length||r[r.length-1][0]!==eA)r.push([eA,n]),i.length1+=t,i.length2+=t,i.utf8Length1+=t,i.utf8Length2+=t;else if(t>r[r.length-1][1].length){let e=t-r[r.length-1][1].length;r[r.length-1][1]+=n.substring(0,e),i.length1+=e,i.length2+=e,i.utf8Length1+=e,i.utf8Length2+=e}return n}(r,l);i=s+i+s,function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4;for(let n=0;n<e.length;n++){if(e[n].length1<=32)continue;let i=e[n];e.splice(n--,1);let r=i.start1,l=i.start2,o="";for(;0!==i.diffs.length;){let s=eY(r-o.length,l-o.length),a=!0;if(""!==o){let e=eV(o);s.length1=o.length,s.utf8Length1=e,s.length2=o.length,s.utf8Length2=e,s.diffs.push([eA,o])}for(;0!==i.diffs.length&&s.length1<32-t;){let e=i.diffs[0][0],n=i.diffs[0][1],o=eV(n);if(e===eR){s.length2+=n.length,s.utf8Length2+=o,l+=n.length;let e=i.diffs.shift();e&&s.diffs.push(e),a=!1}else e===eS&&1===s.diffs.length&&s.diffs[0][0]===eA&&n.length>64?(s.length1+=n.length,s.utf8Length1+=o,r+=n.length,a=!1,s.diffs.push([e,n]),i.diffs.shift()):(o=eV(n=n.substring(0,32-s.length1-t)),s.length1+=n.length,s.utf8Length1+=o,r+=n.length,e===eA?(s.length2+=n.length,s.utf8Length2+=o,l+=n.length):a=!1,s.diffs.push([e,n]),n===i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(n.length))}o=(o=eW(s.diffs)).substring(o.length-t);let c=ez(i.diffs).substring(0,t),h=eV(c);""!==c&&(s.length1+=c.length,s.length2+=c.length,s.utf8Length1+=h,s.utf8Length2+=h,0!==s.diffs.length&&s.diffs[s.diffs.length-1][0]===eA?s.diffs[s.diffs.length-1][1]+=c:s.diffs.push([eA,c])),a||e.splice(++n,0,s)}}}(r,l);let a=0,c=[];for(let e=0;e<r.length;e++){let t=r[e].start2+a,n=ez(r[e].diffs),l,s=-1;if(n.length>32?-1!==(l=eO(i,n.substring(0,32),t))&&(-1===(s=eO(i,n.substring(n.length-32),t+n.length-32))||l>=s)&&(l=-1):l=eO(i,n,t),-1===l)c[e]=!1,a-=r[e].length2-r[e].length1;else{let h;if(c[e]=!0,a=l-t,h=-1===s?i.substring(l,l+n.length):i.substring(l,s+32),n===h)i=i.substring(0,l)+eW(r[e].diffs)+i.substring(l+n.length);else{let t=eD(n,h,{checkLines:!1});if(n.length>32&&function(e){let t=0,n=0,i=0;for(let r=0;r<e.length;r++){let l=e[r][0],o=e[r][1];switch(l){case eR:n+=o.length;break;case eS:i+=o.length;break;case eA:t+=Math.max(n,i),n=0,i=0;break;default:throw Error("Unknown diff operation.")}}return t+Math.max(n,i)}(t)/n.length>o)c[e]=!1;else{t=eM(t);let n=0,o=0;for(let s=0;s<r[e].diffs.length;s++){let a=r[e].diffs[s];a[0]!==eA&&(o=eJ(t,n)),a[0]===eR?i=i.substring(0,l+o)+a[1]+i.substring(l+o):a[0]===eS&&(i=i.substring(0,l+o)+i.substring(l+eJ(t,n+a[1].length))),a[0]!==eS&&(n+=a[1].length)}}}}}return[i=i.substring(s.length,i.length-s.length),c]}(eU(t.value),i.text,{allowExceedingIndices:!0}),o=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:4,n=e.map(e=>em(e)),i=!1,r=[],l=0,o=null,s=0,a=!1,c=!1,h=!1,u=!1;for(;s<n.length;)n[s][0]===eA?(n[s][1].length<t&&(h||u)?(r[l++]=s,a=h,c=u,o=n[s][1]):(l=0,o=null),h=!1,u=!1):(n[s][0]===eS?u=!0:h=!0,o&&(a&&c&&h&&u||o.length<t/2&&3===function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t)=>e+(t?1:0),0)}(a,c,h,u))&&(n.splice(r[l-1],0,[eS,o]),n[r[l-1]+1][0]=eR,l--,o=null,a&&c?(h=!0,u=!0,l=0):(s=--l>0?r[l-1]:-1,h=!1,u=!1),i=!0)),s++;return i&&(n=eT(n)),n}(eD(i.text,l),5);eZ(e,"before");let a=0;for(let[t,n]of o)t===eR?(e.apply({type:"insert_text",path:r,offset:a,text:n}),a+=n.length):t===eS?e.apply({type:"remove_text",path:r,offset:a,text:n}):t===eA&&(a+=n.length);return eZ(e,"after"),!0}(e,t);break;default:eG("Unhandled patch",t.type)}}catch(e){console.error(e)}return n};return function(o){O.set(o,!1),e0.set(o,!0),l=[...o.children];let{apply:c}=o,h=[],u=()=>{if(0===h.length)return;let e=h;h=[];let t=!1;eu(o,()=>{s.ML.withoutNormalizing(o,()=>{e1(o,()=>{ti(o,()=>{e.forEach(e=>{tr.enabled&&tr(`Handling remote patch ${JSON.stringify(e)}`),t=a(o,e)})})})}),t&&(o.normalize(),o.onChange())})},d=({patches:e})=>{let t=e.filter(e=>"local"!==e.origin);0!==t.length&&(h=h.concat(t),u())};return t&&o.subscriptions.push(()=>{tr("Subscribing to patches$");let e=t.subscribe(d);return()=>{tr("Unsubscribing to patches$"),e.unsubscribe()}}),o.apply=t=>{if(i)return c(t),o;let s=[],a=j(l=o.children,r);c(t);let h=j(o.children,r);if(!e0.get(o))return o;switch(a&&!h&&"set_selection"!==t.type&&s.push((0,g.$T)(l,"before",[0])),t.type){case"insert_text":s=[...s,...n.insertTextPatch(o,t,l)];break;case"remove_text":s=[...s,...n.removeTextPatch(o,t,l)];break;case"remove_node":s=[...s,...n.removeNodePatch(o,t,l)];break;case"split_node":s=[...s,...n.splitNodePatch(o,t,l)];break;case"insert_node":s=[...s,...n.insertNodePatch(o,t,l)];break;case"set_node":s=[...s,...n.setNodePatch(o,t,l)];break;case"merge_node":s=[...s,...n.mergeNodePatch(o,t,l)];break;case"move_node":s=[...s,...n.moveNodePatch(o,t,l)]}return!a&&h&&["merge_node","set_node","remove_text","remove_node"].includes(t.type)&&(s=[...s,(0,g.zN)([])],e.next({type:"unset",previousValue:I(l,r.block.name,H.get(o))})),a&&s.length>0&&(s=[(0,g.Cb)([],[]),...s]),s.length>0&&s.forEach(t=>{e.next({type:"patch",patch:{...t,origin:"local"}})}),o},o}}({change$:x,keyGenerator:o,patches$:u,patchFunctions:_,readOnly:p,schemaTypes:v}),T=(n=f||-1,function(e){let{apply:t}=e;return e.apply=i=>{if(ed(e)||eg(e)||ey(e)){t(i);return}n>0&&e.children.length>=n&&("insert_node"===i.type||"split_node"===i.type)&&1===i.path.length||t(i)},e}),C=function(e){return e.pteToggleListItem=t=>{e.pteHasListStyle(t)?(ts(`Remove list item '${t}'`),e.pteUnsetListItem(t)):(ts(`Add list item '${t}'`),e.pteSetListItem(t))},e.pteUnsetListItem=t=>{e.selection&&[...s.ML.nodes(e,{at:e.selection,match:e=>s.W_.isElement(e)&&e._type===v.block.name})].forEach(([n,i])=>{if(e.isListBlock(n)){let{listItem:r,level:l,...o}=n,a={...o,listItem:void 0,level:void 0};ts(`Unsetting list '${t}'`),s.YR.setNodes(e,a,{at:i})}})},e.pteSetListItem=t=>{e.selection&&[...s.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})].forEach(([n,i])=>{ts(`Setting list '${t}'`),s.YR.setNodes(e,{...n,level:1,listItem:t||v.lists[0]&&v.lists[0].value},{at:i})})},e.pteEndList=()=>{if(!e.selection)return!1;let t=[...s.ML.nodes(e,{at:e.selection,match:t=>s.W_.isElement(t)&&e.isListBlock(t)&&1===t.children.length&&s.xv.isText(t.children[0])&&""===t.children[0].text})];return 0!==t.length&&(t.forEach(([t,n])=>{s.W_.isElement(t)&&(ts("Unset list"),s.YR.setNodes(e,{...t,level:void 0,listItem:void 0},{at:n}))}),!0)},e.pteIncrementBlockLevels=t=>{if(!e.selection)return!1;let n=[...s.ML.nodes(e,{at:e.selection,match:t=>!!e.isListBlock(t)})];return 0!==n.length&&(n.forEach(([n,i])=>{if(e.isListBlock(n)){let r=n.level||1;t?ts("Decrementing list level",Math.min(10,Math.max(1,--r))):ts("Incrementing list level",Math.min(10,Math.max(1,++r))),s.YR.setNodes(e,{level:Math.min(10,Math.max(1,r))},{at:i})}}),!0)},e.pteHasListStyle=t=>{if(!e.selection)return!1;let n=[...s.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})];return n.length>0&&n.every(([n])=>e.isListBlock(n)&&n.listItem===t)},e},L=function(e){let{readOnly:t,patches$:n,blockSchemaType:i}=e;return e=>{let r=I(e.children,i.name),l=e4(e);n&&e.subscriptions.push(()=>{e2("Subscribing to patches");let t=n.subscribe(({patches:t,snapshot:n})=>{let i=!1;t.forEach(t=>{if(!i&&"local"!==t.origin&&l){if("unset"===t.type&&0===t.path.length){e2("Someone else cleared the content, resetting undo/redo history"),e.history={undos:[],redos:[]},l.splice(0,l.length),e6.set(e,!0),i=!0;return}l.push({patch:t,time:new Date,snapshot:n,previousSnapshot:r})}}),r=n});return()=>{e2("Unsubscribing to patches"),t.unsubscribe()}}),e.history={undos:[],redos:[]};let{apply:o}=e;return e.apply=n=>{if(t){o(n);return}let{operations:i,history:r}=e,{undos:l}=r,s=l[l.length-1],a=s&&s.operations&&s.operations[s.operations.length-1],c=tt(n,a),h=e5(e),u=!0;if(h){if(s?0===i.length&&(u=te(n,a)||c):u=!1,s&&u)s.operations.push(n);else{let t={operations:[...null===e.selection?[]:[{type:"set_selection",properties:{...e.selection},newProperties:{...e.selection}}],n],timestamp:new Date};l.push(t),e2("Created new undo step",s)}for(;l.length>1e3;)l.shift();tn(n)&&(r.redos=[])}o(n)},e.undo=()=>{if(t)return;let{undos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(e2("Undoing",t),t.operations.length>0){let n=l.filter(e=>e.time>=t.timestamp),i=t.operations;n.forEach(t=>{i=b(i.map(n=>e9(e,t.patch,n,t.snapshot,t.previousSnapshot)))});let r=i.map(s.OX.inverse).reverse();try{s.ML.withoutNormalizing(e,()=>{(function(e,t){let n=eg(e);ep.set(e,!0),t(),ep.set(e,n)})(e,()=>{ti(e,()=>{r.forEach(t=>{e.apply(t)})})})}),e.normalize(),e.onChange()}catch(t){e2("Could not perform undo step",t),l.splice(0,l.length),s.YR.deselect(e),e.history={undos:[],redos:[]},e6.set(e,!0),ep.set(e,!1),e.onChange();return}e.history.redos.push(t),e.history.undos.pop()}}},e.redo=()=>{if(t)return;let{redos:n}=e.history;if(n.length>0){let t=n[n.length-1];if(e2("Redoing",t),t.operations.length>0){let n=l.filter(e=>e.time>=t.timestamp),i=t.operations;n.forEach(t=>{i=b(i.map(n=>e9(e,t.patch,n,t.snapshot,t.previousSnapshot)))});try{s.ML.withoutNormalizing(e,()=>{(function(e,t){let n=ey(e);ef.set(e,!0),t(),ef.set(e,n)})(e,()=>{ti(e,()=>{i.forEach(t=>{e.apply(t)})})})}),e.normalize(),e.onChange()}catch(t){e2("Could not perform redo step",t),l.splice(0,l.length),s.YR.deselect(e),e.history={undos:[],redos:[]},e6.set(e,!0),ef.set(e,!1),e.onChange();return}e.history.undos.push(t),e.history.redos.pop()}}},e}}({readOnly:p,patches$:u,blockSchemaType:v.block}),A=function(e){let{apply:t,normalizeNode:n}=e,i=v.decorators.map(e=>e.value),l=()=>{e.selection&&(s.YR.select(e,{...e.selection}),e.selection={...e.selection});let t=S(e.children,e.selection,v);x.next({type:"selection",selection:t})};return e.normalizeNode=t=>{let[i,l]=t;if(e.isTextBlock(i))for(let[t,n]of s.NB.children(e,l)){let l=i.children[n[1]+1];if(e.isTextSpan(t)&&e.isTextSpan(l)&&r(t.marks,l.marks)){ta("Merging spans",JSON.stringify(t,null,2),JSON.stringify(l,null,2)),s.YR.mergeNodes(e,{at:[n[0],n[1]+1],voids:!0});return}}if(e.isTextSpan(i)&&!Array.isArray(i.marks)){ta("Adding .marks to span node"),s.YR.setNodes(e,{marks:[]},{at:l});return}if(e.isTextSpan(i)){let t=s.y$.parent(l),[n]=s.ML.node(e,t),r=v.decorators.map(e=>e.value),o=i.marks?.filter(e=>!r.includes(e));if(e.isTextBlock(n)&&""===i.text&&o&&o.length>0){ta("Removing annotations from empty span node"),s.YR.setNodes(e,{marks:i.marks?.filter(e=>r.includes(e))},{at:l});return}}if(e.isTextBlock(i)){let t=v.decorators.map(e=>e.value);for(let[n,r]of s.NB.children(e,l))if(e.isTextSpan(n)){let l=n.marks??[],o=l.filter(e=>!t.includes(e)&&!i.markDefs?.find(t=>t._key===e));if(o.length>0){ta("Removing orphaned annotations from span node"),s.YR.setNodes(e,{marks:l.filter(e=>!o.includes(e))},{at:r});return}}}if(e.isTextSpan(i)){let t=s.y$.parent(l),[n]=s.ML.node(e,t);if(e.isTextBlock(n)){let t=v.decorators.map(e=>e.value),r=i.marks??[],o=r.filter(e=>!t.includes(e)&&!n.markDefs?.find(t=>t._key===e));if(o.length>0){ta("Removing orphaned annotations from span node"),s.YR.setNodes(e,{marks:r.filter(e=>!o.includes(e))},{at:l});return}}}if(e.isTextBlock(i)&&!e.operations.some(e=>"merge_node"===e.type&&"markDefs"in e.properties&&1===e.path.length)){let t=(i.markDefs||[]).filter(e=>i.children.find(t=>s.xv.isText(t)&&Array.isArray(t.marks)&&t.marks.includes(e._key)));if(i.markDefs&&!r(t,i.markDefs)){ta("Removing markDef not in use"),s.YR.setNodes(e,{markDefs:t},{at:l});return}}n(t)},e.apply=n=>{if(ed(e)||eg(e)||ey(e)){t(n);return}if("insert_text"===n.type){let{selection:t}=e;if(t&&s.e6.isCollapsed(t)&&s.ML.marks(e)?.marks?.some(e=>!i.includes(e))){let[r]=Array.from(s.ML.nodes(e,{mode:"lowest",at:t.focus,match:e=>e._type===v.span.name,voids:!1}))[0]||[void 0];if(s.xv.isText(r)&&r.text.length===t.focus.offset&&Array.isArray(r.marks)&&r.marks.length>0){let t=(({...s.ML.marks(e)||{}}).marks||[]).filter(e=>i.includes(e));s.YR.insertNodes(e,{_type:"span",_key:o(),text:n.text,marks:t}),ta("Inserting text at end of annotation");return}}}if("remove_text"===n.type){var r,l;let o=Array.from(s.ML.nodes(e,{mode:"lowest",at:{path:n.path,offset:n.offset},match:e=>e._type===v.span.name,voids:!1}))[0][0],a=s.ML.node(e,s.y$.parent(n.path))[0];if(o&&"span"===(r=o)._type&&"text"in r&&"string"==typeof r.text&&(typeof r.marks>"u"||Array.isArray(r.marks)&&r.marks.every(e=>"string"==typeof e))&&a&&"string"==typeof(l=a)._type&&"@"!==l._type[0]&&(!("markDefs"in l)||!l.markDefs||Array.isArray(l.markDefs)&&l.markDefs.every(e=>"string"==typeof e._key))&&"children"in l&&Array.isArray(l.children)&&l.children.every(e=>"object"==typeof e&&"_type"in e)){let r=a.markDefs??[],l=(o.marks??[]).some(e=>r.find(t=>t._key===e)),c=0!==n.offset,h=n.offset+n.text.length===o.text.length;if(l&&c&&h){s.ML.withoutNormalizing(e,()=>{s.YR.splitNodes(e,{match:s.xv.isText,at:{path:n.path,offset:n.offset}}),s.YR.removeNodes(e,{at:s.y$.next(n.path)})}),e.onChange();return}let u=0===n.offset&&h;if(l&&u){let r=(({...s.ML.marks(e)||{}}).marks||[]).filter(e=>i.includes(e));s.ML.withoutNormalizing(e,()=>{t(n),s.YR.setNodes(e,{marks:r},{at:n.path})}),e.onChange();return}if(void 0!==o.marks&&o.marks.length>0&&u){s.ML.withoutNormalizing(e,()=>{t(n),s.YR.setNodes(e,{marks:[]},{at:n.path})}),e.onChange();return}}}if("merge_node"===n.type&&1===n.path.length&&"markDefs"in n.properties&&n.properties._type===v.block.name&&Array.isArray(n.properties.markDefs)&&n.properties.markDefs.length>0&&n.path[0]-1>=0){let[i,r]=s.ML.node(e,[n.path[0]-1]);if(e.isTextBlock(i)){let l=d([...Array.isArray(i.markDefs)&&i.markDefs||[],...n.properties.markDefs]);ta("Copying markDefs over to merged block",n),s.YR.setNodes(e,{markDefs:l},{at:r,voids:!1}),t(n);return}}t(n)},e.addMark=t=>{if(e.selection){if(s.e6.isExpanded(e.selection))s.ML.withoutNormalizing(e,()=>{s.YR.setNodes(e,{},{match:s.xv.isText,split:!0});let n=s.e6.isRange(e.selection)?[...s.ML.nodes(e,{at:e.selection,match:s.xv.isText})]:[];n.length>1&&n.every(e=>e[0].marks?.includes(t))?e.removeMark(t):n.forEach(([n,i])=>{let r=[...(Array.isArray(n.marks)?n.marks:[]).filter(e=>e!==t),t];s.YR.setNodes(e,{marks:r},{at:i,match:s.xv.isText,split:!0,hanging:!0})})});else{let n={...s.ML.marks(e)||{}}.marks||[],i={...s.ML.marks(e)||{},marks:[...n,t]};return e.marks=i,l(),e}e.onChange(),l()}return e},e.removeMark=t=>{let{selection:n}=e;if(n){if(s.e6.isExpanded(n))s.ML.withoutNormalizing(e,()=>{s.YR.setNodes(e,{},{match:s.xv.isText,split:!0}),e.selection&&[...s.ML.nodes(e,{at:e.selection,match:s.xv.isText})].forEach(([n,i])=>{let r=e.children[i[0]];s.W_.isElement(r)&&r.children.includes(n)&&s.YR.setNodes(e,{marks:(Array.isArray(n.marks)?n.marks:[]).filter(e=>e!==t),_type:"span"},{at:i})})}),s.ML.normalize(e);else{let n={...s.ML.marks(e)||{}}.marks||[],i={...s.ML.marks(e)||{},marks:n.filter(e=>e!==t)};return e.marks={marks:i.marks,_type:"span"},l(),e}e.onChange(),l()}return e},e.pteIsMarkActive=t=>{if(!e.selection)return!1;let n=Array.from(s.ML.nodes(e,{match:s.xv.isText,at:e.selection}));return s.e6.isExpanded(e.selection)?n.every(e=>{let[n]=e;return n.marks?.includes(t)}):(({...s.ML.marks(e)||{}}).marks||[]).includes(t)},e.pteToggleMark=t=>{e.pteIsMarkActive(t)?(ta(`Remove mark '${t}'`),s.ML.removeMark(e,t)):(ta(`Add mark '${t}'`),s.ML.addMark(e,t,!0))},e},D=function(e){let t=e.styles[0].value;return function(e){let{normalizeNode:n}=e;return e.normalizeNode=i=>{n(i);let[,r]=i;for(let n of e.operations)if("split_node"===n.type&&1===n.path.length&&e.isTextBlock(n.properties)&&n.properties.style!==t&&n.path[0]===r[0]&&!s.y$.equals(r,n.path)){let[i]=s.ML.node(e,[n.path[0]+1,0]);if(s.xv.isText(i)&&""===i.text){to(`Normalizing split node to ${t} style`,n),s.YR.setNodes(e,{style:t},{at:[n.path[0]+1],voids:!1});break}}},e.pteHasBlockStyle=t=>!!e.selection&&[...s.ML.nodes(e,{at:e.selection,match:n=>e.isTextBlock(n)&&n.style===t})].length>0,e.pteToggleBlockStyle=n=>{e.selection&&([...s.ML.nodes(e,{at:e.selection,match:t=>e.isTextBlock(t)})].forEach(([i,r])=>{e.isTextBlock(i)&&i.style===n?(to(`Unsetting block style '${n}'`),s.YR.setNodes(e,{...i,style:t},{at:r})):(n?to(`Setting style '${n}'`):to("Setting default style",t),s.YR.setNodes(e,{...i,style:n||t},{at:r}))}),e.onChange())},e}}(v),$=function(e){let{apply:t}=e;return e.apply=n=>{if(ed(e)||eg(e)||ey(e)){t(n);return}if("remove_node"===n.type){let t=n.node;if(0===n.path[0]&&s.ML.isVoid(e,t)){let t=s.y$.next(n.path);e.children[t[0]]||(tl("Adding placeholder block"),s.ML.insertNode(e,e.pteCreateEmptyBlock()))}}t(n)},e},B=function(e){let{insertBreak:t}=e;return e.insertBreak=()=>{if(e.selection){let t=e.selection.focus.path.slice(0,1),n=s.NB.descendant(e,t);if(e.isTextBlock(n)){let[,i]=s.e6.edges(e.selection),r=s.ML.isStart(e,i,i.path),l=n&&j([n],v);if(r&&!l){s.ML.insertNode(e,e.pteCreateEmptyBlock());let[n]=s.y$.next(t);s.YR.select(e,{anchor:{path:[n,0],offset:0},focus:{path:[n,0],offset:0}}),e.onChange();return}}}t()},e},Y=function({schemaTypes:e,keyGenerator:t,portableTextEditor:n}){return function(i){return i.pteExpandToWord=()=>{let{selection:e}=i;if(e&&!s.e6.isExpanded(e)){let[t]=s.ML.node(i,e.focus,{depth:2});if(!t||!s.xv.isText(t)||0===t.text.length){td("pteExpandToWord: Can't expand to word here");return}let{focus:n}=e,r=n.offset,l=t.text.slice(0,r),o=t.text.slice(r,-1),a=e=>e.match(/\s/g),c=l.split("").reverse().findIndex(e=>a(e)),h=c>-1?l.length-c:0,u=o.split("").findIndex(e=>a(e)),d=l.length+(u>-1?u:o.length+1);if(!(h===d||isNaN(h)||isNaN(d))){td("pteExpandToWord: Expanding to focused word"),s.YR.setSelection(i,{anchor:{...e.anchor,offset:h},focus:{...e.focus,offset:d}});return}td("pteExpandToWord: Can't expand to word here")}},i.pteCreateEmptyBlock=()=>P([{_type:e.block.name,_key:t(),style:e.styles[0].value||"normal",markDefs:[],children:[{_type:"span",_key:t(),text:"",marks:[]}]}],n)[0],i}}({keyGenerator:o,schemaTypes:v,portableTextEditor:c}),z=(i=null,function(e){let t=()=>{if(i!==e.selection){let t=null;if(e.selection){let n=U.get(e.selection);n?t=n:(t=S(e.children,e.selection,v),U.set(e.selection,t))}th&&tc(`Emitting selection ${JSON.stringify(t||null)} (${JSON.stringify(e.selection)})`),t?x.next({type:"selection",selection:t}):x.next({type:"selection",selection:null})}i=e.selection},{onChange:n}=e;return e.onChange=()=>{let i=e.operations.length>0;n(),i&&t()},e});return e.destroy=()=>{let t=tb.get(e);if(!t)throw Error("Could not find pristine versions of editor functions");e.apply=t.apply,e.history={undos:[],redos:[]},e.normalizeNode=t.normalizeNode,e.onChange=t.onChange},p?{editor:w(N(A(D(Y($(C(z(E(B(e)))))))))),subscribe:()=>l}:{editor:w(N(A(D(C($(Y(T(L(M(z(E(B(e))))))))))))),subscribe:()=>{let t=[];return e.subscriptions.forEach(e=>{t.push(e())}),()=>{t.forEach(e=>{e()})}}}},tx=T("component:PortableTextEditor:SlateContainer");function t_(e){let{patches$:t,portableTextEditor:n,readOnly:r,maxBlocks:l,keyGenerator:c}=e,[[h,u]]=(0,o.useState)(()=>{tx("Creating new Slate editor instance");let{editor:e,subscribe:i}=tv((0,a.BU)((0,s.Jh)()),{keyGenerator:c,maxBlocks:l,patches$:t,portableTextEditor:n,readOnly:r});return H.set(e,{}),J.set(e,{}),[e,i]});(0,o.useEffect)(()=>{let e=u();return()=>{e()}},[u]),(0,o.useEffect)(()=>{tx("Re-initializing plugin chain"),tv(h,{keyGenerator:c,maxBlocks:l,patches$:t,portableTextEditor:n,readOnly:r})},[c,n,l,r,t,h]);let d=(0,o.useMemo)(()=>[h.pteCreateEmptyBlock()],[h]);return(0,o.useEffect)(()=>()=>{tx("Destroying Slate editor"),h.destroy()},[h]),(0,i.jsx)(a.mH,{editor:h,initialValue:d,children:e.children})}let tN=()=>(0,w.E2)(12),tw=(0,o.createContext)(tN),tE=()=>{let e=(0,o.useContext)(tw);if(void 0===e)throw Error("The `usePortableTextEditorKeyGenerator` hook must be used inside the <PortableTextEditor> component's context.");return e},tM=(0,o.createContext)(!1),tT=()=>{let e=(0,o.useContext)(tM);if(void 0===e)throw Error("The `usePortableTextEditorReadOnly` hook must be used inside the <PortableTextEditor> component's context.");return e},tC=T("hook:useSyncValue"),tL=new WeakMap,tS=T("component:PortableTextEditor:Synchronizer"),tR=tS.enabled&&!1;function tA(e){let t=el(),n=tE(),i=tT(),{change$:l,getValue:c,onChange:h,value:u}=e,d=(0,o.useRef)([]),p=function(e){let{portableTextEditor:t,readOnly:n,keyGenerator:i}=e,{change$:l,schemaTypes:c}=t,h=(0,o.useRef)(),u=(0,a.ui)(),d=(0,o.useRef)(),p=(0,o.useCallback)(()=>{let e=tL.get(t);if(h.current===e){tC("Value is the same object as previous, not need to sync");return}d.current&&e&&(tC("Updating the value debounced"),d.current(e))},[t]),f=(0,o.useMemo)(()=>E(p,1e3,{trailing:!0,leading:!1}),[p]);return(0,o.useMemo)(()=>{let e=e=>{tL.set(t,e);let o=Y.get(u),a=ed(u);if(!n){if(o){tC("Has local changes, not syncing value right now"),f();return}if(a){tC("Has remote changes, not syncing value right now"),f();return}}let d=!1,p=!0,g=!!u.selection;if(e&&0!==e.length||(tC("Value is empty"),s.ML.withoutNormalizing(u,()=>{ti(u,()=>{e1(u,()=>{g&&s.YR.deselect(u);let e=u.children.length;u.children.forEach((t,n)=>{s.YR.removeNodes(u,{at:[e-1-n]})}),s.YR.insertNodes(u,u.pteCreateEmptyBlock(),{at:[0]}),g&&s.YR.select(u,[0,0])})})}),d=!0),e&&e.length>0){let t=P(e,{schemaTypes:c});s.ML.withoutNormalizing(u,()=>{eu(u,()=>{ti(u,()=>{e1(u,()=>{let o=u.children.length;if(t.length<o){for(let e=o-1;e>t.length-1;e--)s.YR.removeNodes(u,{at:[e]});d=!0}t.forEach((t,o)=>{let a=u.children[o];if(a&&!r(t,a)&&p){let f=[e[o]],g=tg(f,c,i);!g.valid&&g.resolution?.autoResolve&&g.resolution?.patches.length>0&&!n&&h.current&&h.current!==e&&(console.warn(`${g.resolution.action} for block with _key '${f[0]._key}'. ${g.resolution?.description}`),g.resolution.patches.forEach(e=>{l.next({type:"patch",patch:e})})),g.valid||g.resolution?.autoResolve?(a._key===t._key?(tC.enabled&&tC("Updating block",a,t),function(e,t,n,i){if(s.YR.setNodes(e,t,{at:[i]}),e.isTextBlock(t)&&e.isTextBlock(n)){let l=n.children.length;t.children.length<l&&Array.from(Array(l-t.children.length)).forEach((t,n)=>{let r=l-1-n;r>0&&(tC("Removing child"),s.YR.removeNodes(e,{at:[i,r]}))}),t.children.forEach((t,l)=>{let o=n.children[l],a=!r(t,o),c=!r(t.text,o?.text),h=[i,l];if(a){if(t._key===o?._key){tC("Updating changed child",t,o),s.YR.setNodes(e,t,{at:h});let n=s.xv.isText(t)&&"span"===t._type&&s.xv.isText(o)&&"span"===o._type;n&&c?(s.YR.delete(e,{at:{focus:{path:h,offset:0},anchor:{path:h,offset:o.text.length}}}),s.YR.insertText(e,t.text,{at:h}),e.onChange()):n||(tC("Updating changed inline object child",t),s.YR.setNodes(e,{_key:$},{at:[...h,0],voids:!0}))}else o?(tC("Replacing child",t),s.YR.removeNodes(e,{at:[i,l]}),s.YR.insertNodes(e,t,{at:[i,l]}),e.onChange()):o||(tC("Inserting new child",t),s.YR.insertNodes(e,t,{at:[i,l]}),e.onChange())}})}}(u,t,a,o)):(tC.enabled&&tC("Replacing block",a,t),function(e,t,n){let i=e.selection,r=i&&i.focus.path[0]===n;r&&s.YR.deselect(e),s.YR.removeNodes(e,{at:[n]}),s.YR.insertNodes(e,t,{at:[n]}),e.onChange(),r&&s.YR.select(e,i)}(u,t,o)),d=!0):(l.next({type:"invalidValue",resolution:g.resolution,value:e}),p=!1)}if(!a&&p){let n=tg([e[o]],c,i);tC.enabled&&tC("Validating and inserting new block in the end of the value",t),n.valid||n.resolution?.autoResolve?s.YR.insertNodes(u,t,{at:[o]}):(tC("Invalid",n),l.next({type:"invalidValue",resolution:n.resolution,value:e}),p=!1)}})})})})})}if(!p){tC("Invalid value, returning");return}if(d){tC("Server value changed, syncing editor");try{u.onChange()}catch(t){console.error(t),l.next({type:"invalidValue",resolution:null,value:e});return}g&&!u.selection&&(s.YR.select(u,{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0}}),u.onChange()),l.next({type:"value",value:e})}else tC("Server value and editor value is equal, no need to sync.");h.current=e};return d.current=e,e},[l,i,t,n,c,u,f])}({keyGenerator:n,onChange:h,portableTextEditor:t,readOnly:i}),f=(0,a.ui)();(0,o.useEffect)(()=>{Y.set(f,!1)},[f]);let g=(0,o.useCallback)(()=>{if(d.current.length>0){tS("Flushing pending patches"),tR&&tS(`Patches:
${JSON.stringify(d.current,null,2)}`);let e=c();l.next({type:"mutation",patches:d.current,snapshot:e}),d.current=[]}Y.set(f,!1)},[f,c,l]),y=(0,o.useMemo)(()=>N(()=>{if(s.ML.isNormalizing(f)){g();return}y()},1e3,{leading:!1,trailing:!0}),[g,f]);(0,o.useEffect)(()=>()=>{g()},[g]),(0,o.useEffect)(()=>{tS("Subscribing to editor changes$");let e=l.subscribe(e=>{"patch"===e.type&&(Y.set(f,!0),d.current.push(e.patch),y()),h(e)});return()=>{tS("Unsubscribing to changes$"),e.unsubscribe()}},[l,h,y,f]);let m=(0,o.useCallback)(()=>{tS("Editor is online, syncing from props.value"),l.next({type:"connection",value:"online"}),p(u)},[l,p,u]),k=(0,o.useCallback)(()=>{tS("Editor is offline"),l.next({type:"connection",value:"offline"})},[l]);(0,o.useEffect)(()=>(t.props.patches$&&(window.addEventListener("online",m),window.addEventListener("offline",k)),()=>{t.props.patches$&&(window.removeEventListener("online",m),window.removeEventListener("offline",k))}));let b=(0,o.useRef)(!0);return(0,o.useEffect)(()=>{tS("Value from props changed, syncing new value"),p(u),b.current&&(l.next({type:"loading",isLoading:!1}),l.next({type:"ready"}),b.current=!1)},[l,p,u]),null}let tD=(0,o.createContext)(null),t$=()=>{let e=(0,o.useContext)(tD);if(void 0===e)throw Error("The `usePortableTextEditorSelection` hook must be used inside the <PortableTextEditor> component's context.");return e},tB=T("component:PortableTextEditor:SelectionProvider"),tP=tB.enabled&&!1;function tI(e){let{change$:t}=e,[n,r]=(0,o.useState)(null);return(0,o.useEffect)(()=>{tB("Subscribing to selection changes$");let e=t.subscribe(e=>{"selection"===e.type&&(0,o.startTransition)(()=>{tP&&tB("Setting selection"),r(e.selection)})});return()=>{tB("Unsubscribing to selection changes$"),e.unsubscribe()}},[t]),(0,i.jsx)(tD.Provider,{value:n,children:e.children})}let tj=T("component:PortableTextEditor");class tO extends o.Component{change$=new p.x;schemaTypes;editable;constructor(e){if(super(e),!e.schemaType)throw Error('PortableTextEditor: missing "schemaType" property');e.incomingPatches$&&console.warn("The prop 'incomingPatches$' is deprecated and renamed to 'patches$'"),this.change$.next({type:"loading",isLoading:!0}),this.schemaTypes=es(e.schemaType.hasOwnProperty("jsonType")?e.schemaType:ea(e.schemaType))}componentDidUpdate(e){this.props.schemaType!==e.schemaType&&(this.schemaTypes=es(this.props.schemaType.hasOwnProperty("jsonType")?this.props.schemaType:ea(this.props.schemaType))),this.props.editorRef!==e.editorRef&&this.props.editorRef&&(this.props.editorRef.current=this)}setEditable=e=>{this.editable={...this.editable,...e}};getValue=()=>{if(this.editable)return this.editable.getValue()};render(){let{onChange:e,value:t,children:n,patches$:r,incomingPatches$:l}=this.props,{change$:o}=this,s=typeof this.props.maxBlocks>"u"?void 0:parseInt(this.props.maxBlocks.toString(),10)||void 0,a=!!this.props.readOnly,c=this.props.keyGenerator||tN;return(0,i.jsx)(t_,{keyGenerator:c,maxBlocks:s,patches$:l||r,portableTextEditor:this,readOnly:a,children:(0,i.jsx)(tw.Provider,{value:c,children:(0,i.jsx)(er.Provider,{value:this,children:(0,i.jsx)(tM.Provider,{value:a,children:(0,i.jsxs)(tI,{change$:o,children:[(0,i.jsx)(tA,{change$:o,getValue:this.getValue,onChange:e,value:t}),n]})})})})})}static activeAnnotations=e=>e&&e.editable?e.editable.activeAnnotations():[];static isAnnotationActive=(e,t)=>!!e&&!!e.editable&&e.editable.isAnnotationActive(t);static addAnnotation=(e,t,n)=>e.editable?.addAnnotation(t,n);static blur=e=>{tj("Host blurred"),e.editable?.blur()};static delete=(e,t,n)=>e.editable?.delete(t,n);static findDOMNode=(e,t)=>e.editable?.findDOMNode(t);static findByPath=(e,t)=>e.editable?.findByPath(t)||[];static focus=e=>{tj("Host requesting focus"),e.editable?.focus()};static focusBlock=e=>e.editable?.focusBlock();static focusChild=e=>e.editable?.focusChild();static getSelection=e=>e.editable?e.editable.getSelection():null;static getValue=e=>e.editable?.getValue();static hasBlockStyle=(e,t)=>e.editable?.hasBlockStyle(t);static hasListStyle=(e,t)=>e.editable?.hasListStyle(t);static isCollapsedSelection=e=>e.editable?.isCollapsedSelection();static isExpandedSelection=e=>e.editable?.isExpandedSelection();static isMarkActive=(e,t)=>e.editable?.isMarkActive(t);static insertChild=(e,t,n)=>(tj("Host inserting child"),e.editable?.insertChild(t,n));static insertBlock=(e,t,n)=>e.editable?.insertBlock(t,n);static insertBreak=e=>e.editable?.insertBreak();static isVoid=(e,t)=>e.editable?.isVoid(t);static isObjectPath=(e,t)=>{if(!t||!Array.isArray(t))return!1;let n=t.length>3&&"children"===t[1];return t.length>1&&"children"!==t[1]||n};static marks=e=>e.editable?.marks();static select=(e,t)=>{tj("Host setting selection",t),e.editable?.select(t)};static removeAnnotation=(e,t)=>e.editable?.removeAnnotation(t);static toggleBlockStyle=(e,t)=>(tj("Host is toggling block style"),e.editable?.toggleBlockStyle(t));static toggleList=(e,t)=>e.editable?.toggleList(t);static toggleMark=(e,t)=>{tj("Host toggling mark",t),e.editable?.toggleMark(t)};static getFragment=e=>(tj("Host getting fragment"),e.editable?.getFragment());static undo=e=>{tj("Host undoing"),e.editable?.undo()};static redo=e=>{tj("Host redoing"),e.editable?.redo()};static isSelectionsOverlapping=(e,t,n)=>e.editable?.isSelectionsOverlapping(t,n)}let tY=T("components:Leaf"),tz=[],tW=e=>{let{attributes:t,children:n,leaf:l,schemaTypes:c,renderChild:h,renderDecorator:u,renderAnnotation:p}=e,f=(0,o.useRef)(null),g=el(),y=(0,a.vt)(),[m,k]=(0,o.useState)(!1),[b,v]=(0,o.useState)(!1),x=n.props.parent,_=(0,o.useMemo)(()=>x?[{_key:x?._key},"children",{_key:l._key}]:[],[x,l._key]),N=(0,o.useMemo)(()=>c.decorators.map(e=>e.value),[c.decorators]),w=(0,o.useMemo)(()=>d((l.marks||tz).filter(e=>N.includes(e))),[N,l.marks]),E=Array.isArray(l.marks)?l.marks:tz,M=(0,o.useMemo)(()=>E.map(e=>!N.includes(e)&&x?.markDefs?.find(t=>t._key===e)).filter(Boolean),[E,x,N]),T=M.length>0&&y;(0,o.useEffect)(()=>{if(!T){k(!1);return}let e=tO.getSelection(g);e&&r(e.focus.path,_)&&tO.isCollapsedSelection(g)&&(0,o.startTransition)(()=>{k(!0)})},[T,_,g]);let C=(0,o.useCallback)(()=>{if(!T)return;tY("Setting selection and focus from range");let e=window.getSelection();if(!e){v(!1);return}if(e&&e.rangeCount>0){let t=e.getRangeAt(0);f.current&&t.intersectsNode(f.current)?v(!0):v(!1)}else v(!1)},[T]);(0,o.useEffect)(()=>{if(!T)return;let e=g.change$.subscribe(e=>{if("blur"===e.type){k(!1),v(!1);return}if("focus"===e.type){let e=tO.getSelection(g);e&&r(e.focus.path,_)&&tO.isCollapsedSelection(g)&&k(!0),C();return}"selection"===e.type&&(e.selection&&r(e.selection.focus.path,_)&&tO.isCollapsedSelection(g)?k(!0):k(!1),C())});return()=>{e.unsubscribe()}},[_,g,C,T]),(0,o.useEffect)(()=>C(),[C]);let L=(0,o.useMemo)(()=>{let e=n;if(s.xv.isText(l)&&l._type===c.span.name&&(w.forEach(t=>{let n=c.decorators.find(e=>e.value===t);n&&u&&(e=u(Object.defineProperty({children:e,editorElementRef:f,focused:m,path:_,selected:b,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)})))}),x&&M.length>0&&M.forEach(t=>{let n=c.annotations.find(e=>e.name===t._type);if(n){if(p){let r=Object.defineProperty({block:x,children:e,editorElementRef:f,focused:m,path:_,selected:b,schemaType:n,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),n)});e=(0,i.jsx)("span",{ref:f,children:p(r)})}else e=(0,i.jsx)(eo,{annotation:t,children:(0,i.jsx)("span",{ref:f,children:e})})}}),x&&h)){let t=x.children.find(e=>e._key===l._key);t&&(e=h(Object.defineProperty({annotations:M,children:(0,i.jsx)(i.Fragment,{children:e}),editorElementRef:f,focused:m,path:_,schemaType:c.span,selected:b,value:t},"type",{enumerable:!1,get:()=>(console.warn("Property 'type' is deprecated, use 'schemaType' instead."),c.span)})))}return e},[M,x,n,m,l,w,_,p,h,u,c.annotations,c.decorators,c.span,b]);return(0,o.useMemo)(()=>(0,i.jsx)("span",{...t,ref:f,children:L},l._key),[l,t,L])},tV=T("component:Editable"),tF={position:"absolute",userSelect:"none",pointerEvents:"none",left:0,right:0},tJ=(0,o.forwardRef)(function(e,t){let{hotkeys:n,onBlur:c,onFocus:u,onBeforeInput:d,onPaste:p,onCopy:f,onClick:g,rangeDecorations:y,renderAnnotation:m,renderBlock:k,renderChild:b,renderDecorator:_,renderListItem:N,renderPlaceholder:w,renderStyle:E,selection:M,scrollSelectionIntoView:T,spellCheck:C,...L}=e,D=el(),$=tT(),B=tE(),O=(0,o.useRef)(null),[Y,z]=(0,o.useState)(null),[W,V]=(0,o.useState)(!1),[F,J]=(0,o.useState)([]);(0,o.useImperativeHandle)(t,()=>O.current);let H=(0,o.useRef)(y),{change$:U,schemaTypes:q}=D,G=(0,a.ui)(),K=q.block.name,X=(0,o.useMemo)(()=>function(e){let t=q.block.name,n=q.span.name,i=q.block.options.unstable_whitespaceOnPasteMode,r=t=>t.map(t=>e.isTextBlock(t)?t.children.map(e=>e._type===n?e.text:`[${q.inlineObjects.find(t=>t.name===e._type)?.title||"Object"}]`).join(""):`[${q.blockObjects.find(e=>e.name===t._type)?.title||"Object"}]`).join(`

`);return e.setFragmentData=(n,i)=>{let{selection:l}=e;if(!l)return;let[o,c]=s.e6.edges(l),h=s.ML.void(e,{at:o.path}),u=s.ML.void(e,{at:c.path});if(s.e6.isCollapsed(l)&&!h)return;let d=a.F3.toDOMRange(e,l),p=d.cloneContents();if(u){let[t]=u,n=d.cloneRange(),i=a.F3.toDOMNode(e,t);n.setEndAfter(i),p=n.cloneContents()}Array.from(p.querySelectorAll("[data-slate-zero-width]")).forEach(e=>{let t="n"===e.getAttribute("data-slate-zero-width");e.textContent=t?`
`:""}),Array.from(p.querySelectorAll("*")).forEach(e=>{for(let t in e.removeAttribute("contentEditable"),e.removeAttribute("data-slate-inline"),e.removeAttribute("data-slate-leaf"),e.removeAttribute("data-slate-node"),e.removeAttribute("data-slate-spacer"),e.removeAttribute("data-slate-string"),e.removeAttribute("data-slate-zero-width"),e.removeAttribute("draggable"),e.attributes)e.hasAttribute(t)&&e.removeAttribute(t)});let f=p.ownerDocument.createElement("div");f.appendChild(p),f.setAttribute("hidden","true"),p.ownerDocument.body.appendChild(f);let g=f.innerHTML;p.ownerDocument.body.removeChild(f);let y=I(e.getFragment(),t),m=JSON.stringify(y),k=r(y);n.clearData(),n.setData("text/plain",k),n.setData("text/html",g),n.setData("application/json",m),n.setData("application/x-portable-text",m),ty("text",k),n.setData("application/x-portable-text-event-origin",i||"external"),ty("Set fragment data",m,g)},e.insertPortableTextData=t=>{if(!e.selection)return!1;let i=t.getData("application/x-portable-text"),r=t.getData("application/x-portable-text-event-origin");if(ty(`Inserting portable text from ${r} event`,i),i){let t=JSON.parse(i);if(Array.isArray(t)&&t.length>0){let i=P(t,{schemaTypes:q}).map(t=>{let i={...t};if(e.isTextBlock(i)){let t=q.annotations.map(e=>e.name);if(0===t.length){let{markDefs:e,...t}=i;return{...t,_key:B()}}if((i.markDefs||[]).some(e=>!t.includes(e._type))){let e=(i.markDefs||[]).filter(e=>t.includes(e._type));return{...i,markDefs:e,_key:B()}}i.markDefs=(i.markDefs||[]).map(t=>{let r=t._key,l=B();return i.children=i.children.map(t=>t._type===n&&e.isTextSpan(t)?{...t,marks:t.marks&&t.marks.includes(r)?[...t.marks].filter(e=>e!==r).concat(l):t.marks}:t),{...t,_key:l}})}let r={...i,_key:B()};return e.isTextBlock(r)&&(r.children=r.children.map(e=>({...e,_key:B()}))),r}),r=tg(t,q,B);if(!r.valid&&!r.resolution?.autoResolve){let e=`${r.resolution?.description}`;return U.next({type:"error",level:"warning",name:"pasteError",description:e,data:r}),ty("Invalid insert result",r),!1}return tk(e,i,q),!0}}return!1},e.insertTextOrHTMLData=n=>{if(!e.selection)return ty("No selection, not inserting"),!1;U.next({type:"loading",isLoading:!0});let r=n.getData("text/html"),l=n.getData("text/plain");if(r||l){let o,s,a;if(ty("Inserting data",n),r){if(s=P(o=(0,x.zW)(r,q.portableText,{unstable_whitespaceOnPasteMode:i}).map(e=>(0,x.nX)(e,{blockTypeName:t})),{schemaTypes:q}),a="HTML",0===o.length)return!1}else{let e=`<html><body>${String(l).replace(/[&<>"'`=/]/g,e=>tm[e]).split(/\n{2,}/).map(e=>e?`<p>${e.replace(/(?:\r\n|\r|\n)/g,"<br/>")}</p>`:"<p></p>").join("")}</body></html>`;s=P(o=(0,x.zW)(e,q.portableText).map(e=>(0,x.nX)(e,{blockTypeName:t})),{schemaTypes:q}),a="text"}let c=tg(o,q,B);if(!c.valid){let e=`Could not validate the resulting portable text to insert.
${c.resolution?.description}
Try to insert as plain text (shift-paste) instead.`;return U.next({type:"error",level:"warning",name:"pasteError",description:e,data:c}),ty("Invalid insert result",c),!1}return ty(`Inserting ${a} fragment at ${JSON.stringify(e.selection)}`),tk(e,s,q),U.next({type:"loading",isLoading:!1}),!0}return U.next({type:"loading",isLoading:!1}),!1},e.insertData=t=>{e.insertPortableTextData(t)||e.insertTextOrHTMLData(t)},e.insertFragmentData=t=>{let n=t.getData("application/x-portable-text");if(n){let t=JSON.parse(n);return e.insertFragment(t),!0}return!1},e},[U,B,q]),Z=(0,o.useMemo)(()=>(function(e,t,n){let i=["enter","tab","shift","delete","end"],r=n||tf;return function(n){return n.pteWithHotKeys=l=>{Object.keys(r).forEach(e=>{if("marks"===e)for(let t in r[e]){if(i.includes(t))throw Error(`The hotkey ${t} is reserved!`);if((0,v.P6)(t,l.nativeEvent)){l.preventDefault();let i=r[e];if(i){let e=i[t];tp(`HotKey ${t} to toggle ${e}`),n.pteToggleMark(e)}}}if("custom"===e)for(let n in r[e]){if(i.includes(n))throw Error(`The hotkey ${n} is reserved!`);if((0,v.P6)(n,l.nativeEvent)){let i=r[e];i&&(0,i[n])(l,t)}}});let o=(0,v.P6)("enter",l.nativeEvent),a=(0,v.P6)("tab",l.nativeEvent),c=(0,v.P6)("shift+enter",l.nativeEvent),u=(0,v.P6)("shift+tab",l.nativeEvent),d=(0,v.P6)("backspace",l.nativeEvent),p=(0,v.P6)("delete",l.nativeEvent),f=(0,v.P6)("down",l.nativeEvent),g=(0,v.P6)("up",l.nativeEvent);if(f&&n.selection){let e=s.NB.descendant(n,n.selection.focus.path.slice(0,1));if(e&&s.ML.isVoid(n,e)){let e=s.y$.next(n.selection.focus.path.slice(0,1));if(!s.NB.has(n,e)){s.YR.insertNodes(n,n.pteCreateEmptyBlock(),{at:e}),n.onChange();return}}}if(g&&n.selection){let e=0===n.selection.focus.path[0],t=s.NB.descendant(n,n.selection.focus.path.slice(0,1));if(e&&t&&s.ML.isVoid(n,t)){s.YR.insertNodes(n,n.pteCreateEmptyBlock(),{at:[0]}),s.YR.select(n,{path:[0,0],offset:0}),n.onChange();return}}if(d&&n.selection&&0===n.selection.focus.path[0]&&s.e6.isCollapsed(n.selection)){let e=s.NB.descendant(n,n.selection.focus.path.slice(0,1)),t=s.y$.next(n.selection.focus.path.slice(0,1)),i=s.NB.has(n,t),r=(0,h.DG)(e),o=r&&1===e.children.length&&e.children?.[0]?.text==="";if(i&&r&&o){l.preventDefault(),l.stopPropagation(),s.YR.removeNodes(n,{match:t=>t===e}),n.onChange();return}}if(d&&n.selection&&n.selection.focus.path[0]>0&&s.e6.isCollapsed(n.selection)){let e=s.y$.previous(n.selection.focus.path.slice(0,1)),t=s.NB.descendant(n,e),i=s.NB.descendant(n,n.selection.focus.path.slice(0,1));if(t&&i&&s.ML.isVoid(n,t)&&0===n.selection.focus.offset){tp("Preventing deleting void block above"),l.preventDefault(),l.stopPropagation();let t=(0,h.DG)(i),r=t&&1===i.children.length&&i.children?.[0]?.text==="";if(!t||r){s.YR.removeNodes(n,{match:e=>e===i}),s.YR.select(n,e),n.onChange();return}t&&!r&&(s.YR.select(n,e),n.onChange());return}}if(p&&n.selection&&0===n.selection.focus.offset&&s.e6.isCollapsed(n.selection)&&n.children[n.selection.focus.path[0]+1]){let e=s.NB.descendant(n,s.y$.next(n.selection.focus.path.slice(0,1))),t=n.selection.focus.path.slice(0,1),i=s.NB.descendant(n,t),r=(0,h.DG)(i)&&1===i.children.length&&i.children?.[0]?.text==="";if(e&&i&&!s.ML.isVoid(n,i)&&s.ML.isVoid(n,e)&&r){tp("Preventing deleting void block below"),l.preventDefault(),l.stopPropagation(),s.YR.removeNodes(n,{match:e=>e===i}),s.YR.select(n,t),n.onChange();return}}if((a||u)&&n.selection){let[e]=s.ML.node(n,n.selection.focus,{depth:2}),[t]=(0,h.NG)(e)?s.ML.node(n,n.selection.focus,{depth:1}):[],i=e&&(0,h.DG)(t)&&(0,h.NG)(e)&&(e.marks||[]).filter(e=>(t.markDefs||[]).map(e=>e._key).includes(e)).length>0,[r]=s.e6.edges(n.selection),o=s.ML.isStart(n,r,r.path);e&&(0,h.NG)(e)&&(!i||o)&&n.pteIncrementBlockLevels(u)&&l.preventDefault()}if(o&&!c&&n.selection){let t=n.selection.focus.path.slice(0,1),i=s.NB.descendant(n,t);if(n.isListBlock(i)){n.pteEndList()&&l.preventDefault();return}if(n.isTextBlock(i)&&i.style&&i.style!==e.styles[0].value){let[,e]=s.e6.edges(n.selection);if(s.ML.isEnd(n,e,e.path)){s.ML.insertNode(n,n.pteCreateEmptyBlock()),l.preventDefault(),n.onChange();return}}if(i&&s.ML.isVoid(n,i)){s.ML.insertNode(n,n.pteCreateEmptyBlock()),l.preventDefault(),n.onChange();return}l.preventDefault(),n.insertBreak(),n.onChange()}if(c){l.preventDefault(),n.insertText(`
`);return}if((0,v.P6)("mod+z",l.nativeEvent)){l.preventDefault(),n.undo();return}((0,v.P6)("mod+y",l.nativeEvent)||(0,v.P6)("mod+shift+z",l.nativeEvent))&&(l.preventDefault(),n.redo())},n}})(q,D,n),[n,D,q]);(0,o.useMemo)(()=>$?(tV("Editable is in read only mode"),X(G)):(tV("Editable is in edit mode"),X(Z(G))),[$,G,Z,X]);let Q=(0,o.useCallback)(e=>(0,i.jsx)(ei,{...e,readOnly:$,renderBlock:k,renderChild:b,renderListItem:N,renderStyle:E,schemaTypes:q,spellCheck:C}),[q,C,$,k,b,N,E]),ee=(0,o.useCallback)(e=>{if("span"===e.leaf._type){let t=(0,i.jsx)(tW,{...e,schemaTypes:q,renderAnnotation:m,renderChild:b,renderDecorator:_,readOnly:$});if(w&&e.leaf.placeholder&&""===e.text.text)return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("span",{style:tF,contentEditable:!1,children:w()}),t]});let n=e.leaf.rangeDecoration;return n&&(t=n.component({children:t})),t}return e.children},[$,m,b,_,w,q]),et=(0,o.useCallback)(()=>{if(M){tV(`Selection from props ${JSON.stringify(M)}`);let e=function(e,t){if(!e||!t||0===t.length)return null;let n=null,i=null,{anchor:l,focus:o}=e;return l&&t.find(e=>r({_key:e._key},l.path[0]))&&(n=A(l,t)),o&&t.find(e=>r({_key:e._key},o.path[0]))&&(i=A(o,t)),n&&i?{anchor:n,focus:i,backward:e.backward}:null}(M,I(G.children,K));if(null!==e){tV(`Normalized selection from props ${JSON.stringify(e)}`);let t=R(e,G);t&&(s.YR.select(G,t),G.operations.some(e=>"set_selection"===e.type)||U.next({type:"selection",selection:e}),G.onChange())}}},[M,G,K,U]),en=(0,o.useCallback)(e=>{if(y&&y.length>0){let t=[];if(y.forEach(n=>{let i;let r=R(n.selection,G);if(!s.e6.isRange(r)){n.onMoved&&n.onMoved({newSelection:null,rangeDecoration:n,origin:"local"});return}if(e&&((i=function(e,t){let n=s.E9.transform(e.anchor,t),i=s.E9.transform(e.focus,t);return null===n||null===i?null:s.E9.equals(n,e.anchor)&&s.E9.equals(i,e.focus)?e:{anchor:n,focus:i}}(r,e))&&i!==r||null===i&&r)){let e=S(tO.getValue(D),i,q);n.onMoved&&n.onMoved({newSelection:e,rangeDecoration:n,origin:"local"})}null!==i&&t.push({...i||r,rangeDecoration:n})}),t.length>0){J(t);return}}J([])},[D,y,q,G]);(0,o.useEffect)(()=>{let e=U.subscribe(e=>{switch(e.type){case"ready":et();break;case"invalidValue":V(!0);break;case"value":V(!1)}});return()=>{e.unsubscribe()}},[U,et]),(0,o.useEffect)(()=>{M&&!W&&et()},[W,M,et]);let er=(0,o.useMemo)(()=>G.apply,[G]),[eo,es]=(0,o.useState)(!1);(0,o.useEffect)(()=>{eo||(es(!0),en())},[en,eo]),(0,o.useEffect)(()=>{r(y,H.current)||en(),H.current=y},[y,en]),(0,o.useEffect)(()=>(G.apply=e=>{er(e),"set_selection"!==e.type&&en(e)},()=>{G.apply=er}),[er,G,en]);let ea=(0,o.useCallback)(e=>{f&&void 0!==f(e)&&e.preventDefault()},[f]),ec=(0,o.useCallback)(e=>{if(e.preventDefault(),!G.selection)return;if(!p){tV("Pasting normally"),G.insertData(e.clipboardData);return}let t=tO.getValue(D),n=S(t,G.selection,q)?.focus.path||[],i=p({event:e,value:t,path:n,schemaTypes:q});void 0===i?(tV("No result from custom paste handler, pasting normally"),G.insertData(e.clipboardData)):(U.next({type:"loading",isLoading:!0}),Promise.resolve(i).then(t=>{tV("Custom paste function from client resolved",t),t&&t.insert?t.insert?G.insertFragment(P(t.insert,{schemaTypes:q})):console.warn("Your onPaste function returned something unexpected:",t):(tV("No result from custom paste handler, pasting normally"),G.insertData(e.clipboardData))}).catch(e=>(console.error(e),e)).finally(()=>{U.next({type:"loading",isLoading:!1})}))},[U,p,D,q,G]),eh=(0,o.useCallback)(e=>{if(u&&u(e),!e.isDefaultPrevented()){let t=tO.getSelection(D);null===t&&(s.YR.select(G,s.ML.start(G,[])),G.onChange()),U.next({type:"focus",event:e}),t===tO.getSelection(D)&&U.next({type:"selection",selection:t})}},[u,D,U,G]),eu=(0,o.useCallback)(e=>{if(g&&g(e),G.selection&&e.target===e.currentTarget){let[e,t]=s.NB.last(G,[]),n=G.selection.focus.path.slice(0,1),i=t.slice(0,1);if(s.y$.equals(n,i)){let n=s.NB.descendant(G,t.slice(0,1));e&&s.ML.isVoid(G,n)&&(s.YR.insertNodes(G,G.pteCreateEmptyBlock()),G.onChange())}}},[g,G]),ed=(0,o.useCallback)(e=>{c&&c(e),e.isPropagationStopped()||U.next({type:"blur",event:e})},[U,c]),ep=(0,o.useCallback)(e=>{d&&d(e)},[d]),ef=(0,o.useCallback)(()=>{if(!G.selection)return;let{activeElement:e}=a.F3.findDocumentOrShadowRoot(G);if(O.current!==e)return;let t=a.F3.getWindow(G).getSelection();if(!t||0===t.rangeCount)return;let n=t.getRangeAt(0);try{let e=a.F3.toDOMRange(G,G.selection);(e.startOffset!==n.startOffset||e.endOffset!==n.endOffset)&&(tV("DOM range out of sync, validating selection"),t?.removeAllRanges(),t.addRange(e))}catch{tV("Could not resolve selection, selecting top document"),s.YR.deselect(G),G.children.length>0&&s.YR.select(G,[0,0]),G.onChange()}},[O,G]);(0,o.useEffect)(()=>{if(Y){let e=new MutationObserver(ef);return e.observe(Y,{attributeOldValue:!1,attributes:!1,characterData:!1,childList:!0,subtree:!0}),()=>{e.disconnect()}}},[ef,Y]);let eg=(0,o.useCallback)(t=>{e.onKeyDown&&e.onKeyDown(t),t.isDefaultPrevented()||G.pteWithHotKeys(t)},[e,G]),ey=(0,o.useMemo)(()=>{if(void 0!==T)return null===T?l:(e,t)=>{T(D,t)}},[D,T]),em=(0,o.useCallback)(([,e])=>{if(j(G.children,q))return[{anchor:{path:[0,0],offset:0},focus:{path:[0,0],offset:0},placeholder:!0}];if(0===e.length)return[];let t=F.filter(t=>s.e6.isCollapsed(t)?2===e.length&&s.y$.equals(t.focus.path,e)&&s.y$.equals(t.anchor.path,e):s.e6.intersection(t,{anchor:{path:e,offset:0},focus:{path:e,offset:0}})||s.e6.includes(t,e));return t.length>0?t:[]},[G,q,F]);return(0,o.useEffect)(()=>{O.current=a.F3.toDOMNode(G,G),z(O.current)},[G,O]),D?W?null:(0,i.jsx)(a.CX,{...L,autoFocus:!1,className:L.className||"pt-editable",decorate:em,onBlur:ed,onCopy:ea,onClick:eu,onDOMBeforeInput:ep,onFocus:eh,onKeyDown:eg,onPaste:ec,readOnly:$,renderPlaceholder:void 0,renderElement:Q,renderLeaf:ee,scrollSelectionIntoView:ey}):null})}}]);